<!DOCTYPE html>

<html lang="en" data-content_root="../../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>populse_mia.user_interface.data_browser.mini_viewer &#8212; populse_mia 2.5.1-dev+53a60969 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=f63d8bfa" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/haiku.css?v=e491ac2d" />
    <script src="../../../../_static/documentation_options.js?v=8f6e2028"></script>
    <script src="../../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="https://unpkg.com/mermaid@10.2.0/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="../../../../index.html">
          <span>populse_mia 2.5.1-dev+53a60969 documentation</span></a></h1>
        <h2 class="heading"><span>populse_mia.user_interface.data_browser.mini_viewer</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        <a class="uplink" href="../../../../index.html">Contents</a>
        </p>

      </div>
      <div class="content" role="main">
        
        
  <h1>Source code for populse_mia.user_interface.data_browser.mini_viewer</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module to define the mini viewer.</span>

<span class="sd">Contains:</span>
<span class="sd">    Class:</span>
<span class="sd">        - MiniViewer</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1">##########################################################################</span>
<span class="c1"># Populse_mia - Copyright (C) IRMaGe/CEA, 2018</span>
<span class="c1"># Distributed under the terms of the CeCILL license, as published by</span>
<span class="c1"># the CEA-CNRS-INRIA. Refer to the LICENSE file or to</span>
<span class="c1"># http://www.cecill.info/licences/Licence_CeCILL_V2.1-en.html</span>
<span class="c1"># for details.</span>
<span class="c1">##########################################################################</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="kn">import</span> <span class="nn">nibabel</span> <span class="k">as</span> <span class="nn">nib</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>  <span class="c1"># a N-dimensional array object</span>
<span class="kn">import</span> <span class="nn">skimage</span> <span class="k">as</span> <span class="nn">sk</span>

<span class="c1"># Populse_MIA imports</span>
<span class="kn">from</span> <span class="nn">packaging</span> <span class="kn">import</span> <span class="n">version</span>
<span class="kn">from</span> <span class="nn">PyQt5</span> <span class="kn">import</span> <span class="n">QtCore</span>

<span class="c1"># PyQt5 imports</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtCore</span> <span class="kn">import</span> <span class="n">Qt</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtGui</span> <span class="kn">import</span> <span class="n">QFont</span><span class="p">,</span> <span class="n">QImage</span><span class="p">,</span> <span class="n">QPixmap</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">QCheckBox</span><span class="p">,</span>
    <span class="n">QFrame</span><span class="p">,</span>
    <span class="n">QHBoxLayout</span><span class="p">,</span>
    <span class="n">QLabel</span><span class="p">,</span>
    <span class="n">QLineEdit</span><span class="p">,</span>
    <span class="n">QScrollArea</span><span class="p">,</span>
    <span class="n">QSizePolicy</span><span class="p">,</span>
    <span class="n">QSlider</span><span class="p">,</span>
    <span class="n">QVBoxLayout</span><span class="p">,</span>
    <span class="n">QWidget</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># from scipy.ndimage import rotate  # to work with NumPy arrays</span>
<span class="kn">from</span> <span class="nn">skimage.transform</span> <span class="kn">import</span> <span class="n">resize</span>

<span class="kn">from</span> <span class="nn">populse_mia.data_manager.project</span> <span class="kn">import</span> <span class="n">COLLECTION_CURRENT</span>
<span class="kn">from</span> <span class="nn">populse_mia.software_properties</span> <span class="kn">import</span> <span class="n">Config</span>
<span class="kn">from</span> <span class="nn">populse_mia.user_interface.data_browser</span> <span class="kn">import</span> <span class="n">data_browser</span>
<span class="kn">from</span> <span class="nn">populse_mia.user_interface.pop_ups</span> <span class="kn">import</span> <span class="n">ClickableLabel</span><span class="p">,</span> <span class="n">PopUpSelectTag</span>


<div class="viewcode-block" id="MiniViewer">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.data_browser.html#populse_mia.user_interface.data_browser.mini_viewer.MiniViewer">[docs]</a>
<span class="k">class</span> <span class="nc">MiniViewer</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;MiniViewer that allows to rapidly visualize scans either with a single</span>
<span class="sd">    image per scan with cursors to move in five dimensions or with all images</span>
<span class="sd">    of the greater dimension of the scan.</span>

<span class="sd">    When the latter is selected, the displayed images depends on their</span>
<span class="sd">    dimension:</span>

<span class="sd">        - 3D: display all the slices.</span>
<span class="sd">        - 4D: display the middle slice of the third dimension for each time</span>
<span class="sd">           of the fourth dimension.</span>
<span class="sd">        - 5D: display the middle slice of the third dimension for the first</span>
<span class="sd">           time of the fourth dimension for each time of the fifth dimension.</span>

<span class="sd">    Note:</span>
<span class="sd">        - idx corresponds to the index of the displayed image</span>
<span class="sd">        - idx in [0, self.max_scans]</span>
<span class="sd">        - most of the class&#39;s attributes are lists of 0 to self.max_scans</span>
<span class="sd">           elements</span>

<span class="sd">    .. Methods:</span>
<span class="sd">        - __init__: initialise the MiniViewer object</span>
<span class="sd">        - boxSlider: create sliders, their connections and thumbnail labels</span>
<span class="sd">          for a selected index</span>
<span class="sd">        - changePosValue: change the value of a cursor for the selected index</span>
<span class="sd">        - check_box_cursors_state_changed: updates the config file</span>
<span class="sd">        - clear: remove the Nibabel images to be able to remove it in the</span>
<span class="sd">          unit tests</span>
<span class="sd">        - clearLayouts: clear the final layout</span>
<span class="sd">        - create_slider: create a slider</span>
<span class="sd">        - createDimensionLabels: create the dimension labels for the</span>
<span class="sd">          selected index</span>
<span class="sd">        - createFieldValue: create a field where will be displayed the</span>
<span class="sd">          position of a cursor</span>
<span class="sd">        - createLayouts: create the layouts</span>
<span class="sd">        - displayPosValue: display the position of each cursor for the</span>
<span class="sd">          selected index</span>
<span class="sd">        - enableSliders: enable each slider of the selected index</span>
<span class="sd">        - image_to_pixmap: create a 2D pixmap from a N-D Nifti image</span>
<span class="sd">        - image2DModifications: apply modifications to the image to</span>
<span class="sd">          display it correctly</span>
<span class="sd">        - indexImage: update the sliders values depending on the size of</span>
<span class="sd">          the selected image</span>
<span class="sd">        - mem_release: reset all object lists to zero in order to</span>
<span class="sd">          preserve memory</span>
<span class="sd">        - navigImage: display the 2D image for the selected index</span>
<span class="sd">        - openTagsPopUp: opens a pop-up to select the legend of the thumbnails</span>
<span class="sd">        - setThumbnail: set the thumbnail tag value under the image frame</span>
<span class="sd">        - show_slices: create the thumbnails from the selected file paths</span>
<span class="sd">        - update_nb_slices: update the config file and the thumbnails</span>
<span class="sd">        - update_visualization_method: update the config file and the</span>
<span class="sd">          thumbnails</span>
<span class="sd">        - verify_slices: verify the number of selected documents</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="MiniViewer.__init__">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.data_browser.html#populse_mia.user_interface.data_browser.mini_viewer.MiniViewer.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise the MiniViewer object</span>

<span class="sd">        :param project: current project in the software</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">project</span> <span class="o">=</span> <span class="n">project</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">first_time</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># The MiniViewer is set hidden to give more space to the data_browser</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setHidden</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Config that allows to read the software preferences</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>

        <span class="c1"># When multiple selection, limiting the number of thumbnails to</span>
        <span class="c1"># max_scans</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_scans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_max_thumbnails</span><span class="p">()</span>

        <span class="c1"># Initializing some components of the MiniViewer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">QWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">QFrame</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scroll_area</span> <span class="o">=</span> <span class="n">QScrollArea</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scroll_area</span><span class="o">.</span><span class="n">setWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame_final</span> <span class="o">=</span> <span class="n">QFrame</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">label_nb_slices</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_nb_slices</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Maximum number of slices: &quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">line_edit_nb_slices</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_edit_nb_slices</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getNbAllSlicesMax</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_edit_nb_slices</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_nb_slices</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">label_orientation</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">isRadioView</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label_orientation</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Radiological orientation&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label_orientation</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Neurological orientation&quot;</span><span class="p">)</span>

        <span class="c1"># All these objects are depending on the number of scans to visualize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">im_2D</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider_3D</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider_4D</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider_5D</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">txt_slider_3D</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">txt_slider_4D</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">txt_slider_5D</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label3D</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label4D</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label5D</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imageLabel</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_description</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Layouts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createLayouts</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_box_final</span><span class="p">)</span>

        <span class="c1"># Checkboxes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_box_slices</span> <span class="o">=</span> <span class="n">QCheckBox</span><span class="p">(</span><span class="s2">&quot;Show all slices (no cursors)&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getShowAllSlices</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_box_slices</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_box_slices</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_box_slices</span><span class="o">.</span><span class="n">stateChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_visualization_method</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">check_box_cursors</span> <span class="o">=</span> <span class="n">QCheckBox</span><span class="p">(</span><span class="s2">&quot;Chain cursors&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_box_cursors</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
            <span class="s2">&quot;Allows to connect all cursors &quot;</span>
            <span class="s2">&quot;when selecting multiple documents&quot;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getChainCursors</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_box_cursors</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_box_cursors</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_box_cursors</span><span class="o">.</span><span class="n">stateChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_box_cursors_state_changed</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">file_paths</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span></div>


<div class="viewcode-block" id="MiniViewer.boxSlider">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.data_browser.html#populse_mia.user_interface.data_browser.mini_viewer.MiniViewer.boxSlider">[docs]</a>
    <span class="k">def</span> <span class="nf">boxSlider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define horizontal sliders connections and thumbnail labels.</span>

<span class="sd">        :param idx: the selected index</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider_3D</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_slider</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider_4D</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_slider</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider_5D</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_slider</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">slider_3D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">changePosValue</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider_4D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">changePosValue</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider_5D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">changePosValue</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">txt_slider_3D</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">createFieldValue</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">txt_slider_4D</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">createFieldValue</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">txt_slider_5D</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">createFieldValue</span><span class="p">())</span></div>


<div class="viewcode-block" id="MiniViewer.check_box_cursors_state_changed">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.data_browser.html#populse_mia.user_interface.data_browser.mini_viewer.MiniViewer.check_box_cursors_state_changed">[docs]</a>
    <span class="k">def</span> <span class="nf">check_box_cursors_state_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the config file.</span>

<span class="sd">        Called when the state of the checkbox to chain the cursors changes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_box_cursors</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setChainCursors</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_box_cursors</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setChainCursors</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="MiniViewer.clear">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.data_browser.html#populse_mia.user_interface.data_browser.mini_viewer.MiniViewer.clear">[docs]</a>
    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove the Nibabel images to be able to remove it in the unit tests</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">delattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;img&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span></div>


<div class="viewcode-block" id="MiniViewer.clearLayouts">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.data_browser.html#populse_mia.user_interface.data_browser.mini_viewer.MiniViewer.clearLayouts">[docs]</a>
    <span class="k">def</span> <span class="nf">clearLayouts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear the final layout&quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_box_final</span><span class="o">.</span><span class="n">count</span><span class="p">())):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_box_final</span><span class="o">.</span><span class="n">itemAt</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">v_box_final</span><span class="o">.</span><span class="n">itemAt</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span></div>


<div class="viewcode-block" id="MiniViewer.changePosValue">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.data_browser.html#populse_mia.user_interface.data_browser.mini_viewer.MiniViewer.changePosValue">[docs]</a>
    <span class="k">def</span> <span class="nf">changePosValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">cursor_to_change</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change the value of a cursor for the selected index.</span>

<span class="sd">        :param idx: the selected index</span>
<span class="sd">        :param cursor_to_change: the cursor to change (1, 2 or 3)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If the &quot;Chain cursors&quot; mode is not selected, there is nothing to do</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_box_cursors</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">navigImage</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Checking with cursor has been modified</span>
            <span class="k">if</span> <span class="n">cursor_to_change</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slider_3D</span>
            <span class="k">elif</span> <span class="n">cursor_to_change</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slider_4D</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slider_5D</span>

            <span class="c1"># Loop on the thumbnails</span>
            <span class="k">for</span> <span class="n">idx_loop</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_scans</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_paths</span><span class="p">))):</span>
                <span class="c1"># Disconnecting the connection when changing other cursors</span>
                <span class="c1"># values</span>
                <span class="n">cursor</span><span class="p">[</span><span class="n">idx_loop</span><span class="p">]</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
                <span class="c1"># Do something only when the cursor is not the one that has</span>
                <span class="c1"># been changed by the user</span>
                <span class="k">if</span> <span class="n">idx_loop</span> <span class="o">!=</span> <span class="n">idx</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">cursor</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">==</span> <span class="n">cursor</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">maximum</span><span class="p">():</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">cursor</span><span class="p">[</span><span class="n">idx_loop</span><span class="p">]</span><span class="o">.</span><span class="n">maximum</span><span class="p">()</span>

                    <span class="k">elif</span> <span class="n">cursor</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">==</span> <span class="n">cursor</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">minimum</span><span class="p">():</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">cursor</span><span class="p">[</span><span class="n">idx_loop</span><span class="p">]</span><span class="o">.</span><span class="n">minimum</span><span class="p">()</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Updating the new value as the value of the cursor</span>
                        <span class="c1"># that has been changed by the user</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span>
                            <span class="p">(</span><span class="n">cursor</span><span class="p">[</span><span class="n">idx_loop</span><span class="p">]</span><span class="o">.</span><span class="n">maximum</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                            <span class="o">*</span> <span class="p">(</span><span class="n">cursor</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                            <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">cursor</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">maximum</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="p">)</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">cursor</span><span class="p">[</span><span class="n">idx_loop</span><span class="p">]</span><span class="o">.</span><span class="n">maximum</span><span class="p">(),</span> <span class="n">value</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
                    <span class="n">cursor</span><span class="p">[</span><span class="n">idx_loop</span><span class="p">]</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

                <span class="c1"># Changing the image to show</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">navigImage</span><span class="p">(</span><span class="n">idx_loop</span><span class="p">)</span>
                <span class="c1"># Reconnecting</span>
                <span class="n">cursor</span><span class="p">[</span><span class="n">idx_loop</span><span class="p">]</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                    <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">changePosValue</span><span class="p">,</span> <span class="n">idx_loop</span><span class="p">,</span> <span class="n">cursor_to_change</span><span class="p">)</span>
                <span class="p">)</span></div>


<div class="viewcode-block" id="MiniViewer.createDimensionLabels">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.data_browser.html#populse_mia.user_interface.data_browser.mini_viewer.MiniViewer.createDimensionLabels">[docs]</a>
    <span class="k">def</span> <span class="nf">createDimensionLabels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the dimension labels for the selected index.</span>

<span class="sd">        :param idx: the selected index</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">font</span> <span class="o">=</span> <span class="n">QFont</span><span class="p">()</span>
        <span class="n">font</span><span class="o">.</span><span class="n">setPointSize</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">label3D</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label4D</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label5D</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">label3D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">font</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label4D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">font</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label5D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">font</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">label3D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;3D: &quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label4D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;4D: &quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label5D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;5D: &quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="MiniViewer.createFieldValue">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.data_browser.html#populse_mia.user_interface.data_browser.mini_viewer.MiniViewer.createFieldValue">[docs]</a>
    <span class="k">def</span> <span class="nf">createFieldValue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a field where will be displayed the position of a cursor.</span>

<span class="sd">        :return: the corresponding field</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fieldValue</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">()</span>
        <span class="n">fieldValue</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">fieldValue</span><span class="o">.</span><span class="n">setFixedWidth</span><span class="p">(</span><span class="mi">65</span><span class="p">)</span>
        <span class="n">fieldValue</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>
        <span class="n">fieldValue</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">,</span> <span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">)</span>
        <span class="n">font</span> <span class="o">=</span> <span class="n">QFont</span><span class="p">()</span>
        <span class="n">font</span><span class="o">.</span><span class="n">setPointSize</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
        <span class="n">fieldValue</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">font</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fieldValue</span></div>


<div class="viewcode-block" id="MiniViewer.createLayouts">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.data_browser.html#populse_mia.user_interface.data_browser.mini_viewer.MiniViewer.createLayouts">[docs]</a>
    <span class="k">def</span> <span class="nf">createLayouts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the layouts.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">h_box_images</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h_box_images</span><span class="o">.</span><span class="n">setSpacing</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_box</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_box_final</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h_box_slider_3D</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h_box_slider_4D</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h_box_slider_5D</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_box_sliders</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h_box</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h_box_check_box</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_box_thumb</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h_box_thumb</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span></div>


<div class="viewcode-block" id="MiniViewer.create_slider">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.data_browser.html#populse_mia.user_interface.data_browser.mini_viewer.MiniViewer.create_slider">[docs]</a>
    <span class="k">def</span> <span class="nf">create_slider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maxm</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">minm</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate an horizontal slider.</span>

<span class="sd">        :param maxm: slider&#39;s maximum</span>
<span class="sd">        :param minm: slider&#39;s minimum</span>
<span class="sd">        :param pos: slider&#39;s initial value</span>
<span class="sd">        :return: the slider object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">slider</span> <span class="o">=</span> <span class="n">QSlider</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Horizontal</span><span class="p">)</span>
        <span class="n">slider</span><span class="o">.</span><span class="n">setFocusPolicy</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">StrongFocus</span><span class="p">)</span>
        <span class="n">slider</span><span class="o">.</span><span class="n">setTickInterval</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">slider</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="n">maxm</span><span class="p">)</span>
        <span class="n">slider</span><span class="o">.</span><span class="n">setMinimum</span><span class="p">(</span><span class="n">minm</span><span class="p">)</span>
        <span class="n">slider</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
        <span class="n">slider</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">slider</span></div>


<div class="viewcode-block" id="MiniViewer.displayPosValue">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.data_browser.html#populse_mia.user_interface.data_browser.mini_viewer.MiniViewer.displayPosValue">[docs]</a>
    <span class="k">def</span> <span class="nf">displayPosValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Display the position of each cursor for the selected index.</span>

<span class="sd">        :param idx: the selected index</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">txt_slider_3D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slider_3D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot; / &quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slider_3D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">maximum</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">txt_slider_4D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slider_4D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot; / &quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slider_4D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">maximum</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">txt_slider_5D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slider_5D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot; / &quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slider_5D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">maximum</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="MiniViewer.enableSliders">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.data_browser.html#populse_mia.user_interface.data_browser.mini_viewer.MiniViewer.enableSliders">[docs]</a>
    <span class="k">def</span> <span class="nf">enableSliders</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable all the horizontal slider.</span>

<span class="sd">        :param idx: the slider&#39;s index</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider_3D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider_4D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slider_5D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="MiniViewer.image_to_pixmap">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.data_browser.html#populse_mia.user_interface.data_browser.mini_viewer.MiniViewer.image_to_pixmap">[docs]</a>
    <span class="k">def</span> <span class="nf">image_to_pixmap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">im</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a 2D pixmap from a N-D Nifti image.</span>

<span class="sd">        :param im: Nifti image</span>
<span class="sd">        :param i: index of the slide</span>
<span class="sd">        :return: the corresponding pixmap</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># The image to display depends on the dimension of the image</span>
        <span class="c1"># In the 3D case, each slice is displayed</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="c1"># im_2D = im.get_fdata()[:, :, i].copy()</span>
            <span class="n">im_2D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">dataobj</span><span class="p">)[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># In the 4D case, each middle slice of the 3D dimension is displayed</span>
        <span class="c1"># for each time in the 4D dimension</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="c1"># im_3D = im.get_fdata()[:, :, :, i].copy()</span>
            <span class="n">im_3D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">dataobj</span><span class="p">)[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">middle_slice</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">im_3D</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">im_2D</span> <span class="o">=</span> <span class="n">im_3D</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">middle_slice</span><span class="p">]</span>

        <span class="c1"># In the 5D case, each first time of the 4D dimension and</span>
        <span class="c1"># its middle slice of the 3D dimension is displayed</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="c1"># im_4D = im.get_fdata()[:, :, :, :, i].copy()</span>
            <span class="n">im_4D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">dataobj</span><span class="p">)[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">im_3D</span> <span class="o">=</span> <span class="n">im_4D</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">middle_slice</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">im_3D</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">im_2D</span> <span class="o">=</span> <span class="n">im_3D</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">middle_slice</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">im_2D</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Making some pixel modification to display the image correctly</span>
        <span class="n">im_2D</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image2DModifications</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">im_2D</span><span class="p">)</span>

        <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">im_2D</span><span class="o">.</span><span class="n">shape</span>

        <span class="n">im_Qt</span> <span class="o">=</span> <span class="n">QImage</span><span class="p">(</span><span class="n">im_2D</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">QImage</span><span class="o">.</span><span class="n">Format_Indexed8</span><span class="p">)</span>
        <span class="n">pixm</span> <span class="o">=</span> <span class="n">QPixmap</span><span class="o">.</span><span class="n">fromImage</span><span class="p">(</span><span class="n">im_Qt</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">pixm</span></div>


<div class="viewcode-block" id="MiniViewer.image2DModifications">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.data_browser.html#populse_mia.user_interface.data_browser.mini_viewer.MiniViewer.image2DModifications">[docs]</a>
    <span class="k">def</span> <span class="nf">image2DModifications</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">im2D</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply modifications to display the image correctly.</span>

<span class="sd">        :param idx: the selected index</span>
<span class="sd">        :param im2D: image to modify</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">display_size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span>
        <span class="n">display_type</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span>  <span class="c1"># this MUST be an integer data type</span>
        <span class="n">display_pctl</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c1"># percentile (0.5%) of values to clip at the</span>
        <span class="c1"># low and high end of intensities.</span>
        <span class="n">display_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">display_type</span><span class="p">)</span><span class="o">.</span><span class="n">max</span>
        <span class="n">display_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">display_type</span><span class="p">)</span><span class="o">.</span><span class="n">min</span>

        <span class="n">im2d_provided</span> <span class="o">=</span> <span class="n">im2D</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">im2d_provided</span><span class="p">:</span>
            <span class="n">im2D</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">im_2D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

        <span class="c1"># Resize image first, for three reasons:</span>
        <span class="c1">#  1 - it may slightly changes the intensity scale, so re-scaling</span>
        <span class="c1">#      should be done after this</span>
        <span class="c1">#  2 - rescaling before rotation is slightly faster, specially for</span>
        <span class="c1">#      large images (&gt; display_size).</span>
        <span class="c1">#  3 - rescaling may alter the occurrence of nan or infinite values</span>
        <span class="c1">#      (e.g. an image may become all-nan), anti_aliasing keyword is</span>
        <span class="c1">#      defined in skimage since version 0.14.0</span>

        <span class="k">if</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">sk</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">version</span><span class="o">.</span><span class="n">Version</span><span class="p">(</span><span class="s2">&quot;0.14.0&quot;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">im2D</span> <span class="o">=</span> <span class="n">resize</span><span class="p">(</span>
                    <span class="n">im2D</span><span class="p">,</span> <span class="n">display_size</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span><span class="p">,</span> <span class="n">anti_aliasing</span><span class="o">=</span><span class="kc">False</span>
                <span class="p">)</span>

            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">im2D</span> <span class="o">=</span> <span class="n">resize</span><span class="p">(</span>
                    <span class="n">im2D</span><span class="o">.</span><span class="n">byteswap</span><span class="p">()</span><span class="o">.</span><span class="n">newbyteorder</span><span class="p">(),</span>
                    <span class="n">display_size</span><span class="p">,</span>
                    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span><span class="p">,</span>
                    <span class="n">anti_aliasing</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">im2D</span> <span class="o">=</span> <span class="n">resize</span><span class="p">(</span><span class="n">im2D</span><span class="p">,</span> <span class="n">display_size</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">im2D</span> <span class="o">=</span> <span class="n">resize</span><span class="p">(</span>
                    <span class="n">im2D</span><span class="o">.</span><span class="n">byteswap</span><span class="p">()</span><span class="o">.</span><span class="n">newbyteorder</span><span class="p">(),</span>
                    <span class="n">display_size</span><span class="p">,</span>
                    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="c1"># Rescale image while handling Nans and infinite values</span>
        <span class="n">im_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">im2D</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">im_mask</span><span class="p">):</span>  <span class="c1"># if we have any finite value to work with</span>
            <span class="c1"># shift the lower percentile chosen to 0.0</span>
            <span class="n">im2D</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">im2D</span><span class="p">[</span><span class="n">im_mask</span><span class="p">],</span> <span class="n">display_pctl</span><span class="p">)</span>
            <span class="c1"># determine max from upper percentile</span>
            <span class="n">im_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">im2D</span><span class="p">[</span><span class="n">im_mask</span><span class="p">],</span> <span class="mf">100.0</span> <span class="o">-</span> <span class="n">display_pctl</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">im_max</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># avoid dividing by zero</span>
                <span class="c1"># re-scale to display range</span>
                <span class="n">im2D</span> <span class="o">*=</span> <span class="p">(</span><span class="n">display_max</span> <span class="o">-</span> <span class="n">display_min</span><span class="p">)</span> <span class="o">/</span> <span class="n">im_max</span>
            <span class="c1"># shift lowest value to lower limit of display range</span>
            <span class="n">im2D</span> <span class="o">+=</span> <span class="n">display_min</span>

        <span class="c1"># clip all values to display range, remove infinite values</span>
        <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">im2D</span><span class="p">,</span> <span class="n">display_min</span><span class="p">,</span> <span class="n">display_max</span><span class="p">,</span> <span class="n">im2D</span><span class="p">)</span>
        <span class="c1"># convert to integer display data type. NaNs get converted to 0.</span>
        <span class="n">im2D</span> <span class="o">=</span> <span class="n">im2D</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">display_type</span><span class="p">)</span>

        <span class="c1"># Rotate. Copy array to avoid negative strides (Qt doesn&#39;t handle that)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">isRadioView</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">im2D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">im2D</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># radiological</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">im2D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">im2D</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># neurological</span>

        <span class="k">if</span> <span class="n">im2d_provided</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">im2D</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">im_2D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">im2D</span></div>


<div class="viewcode-block" id="MiniViewer.indexImage">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.data_browser.html#populse_mia.user_interface.data_browser.mini_viewer.MiniViewer.indexImage">[docs]</a>
    <span class="k">def</span> <span class="nf">indexImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update all slider values according to the size of the current image.</span>

<span class="sd">        :param idx: the selected index</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Getting the sliders value</span>
        <span class="n">sl3D</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slider_3D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">sl4D</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slider_4D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="n">sl5D</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slider_5D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>

        <span class="c1"># Depending on the dimension, reading the image data and</span>
        <span class="c1"># changing the cursors maximum</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">im_2D</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                <span class="n">idx</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">dataobj</span><span class="p">)[:,</span> <span class="p">:,</span> <span class="n">sl3D</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slider_3D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slider_4D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slider_5D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">im_2D</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                <span class="n">idx</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">dataobj</span><span class="p">)[:,</span> <span class="p">:,</span> <span class="n">sl3D</span><span class="p">,</span> <span class="n">sl4D</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slider_3D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slider_4D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slider_5D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">im_2D</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                <span class="n">idx</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">dataobj</span><span class="p">)[</span>
                    <span class="p">:,</span> <span class="p">:,</span> <span class="n">sl3D</span><span class="p">,</span> <span class="n">sl4D</span><span class="p">,</span> <span class="n">sl5D</span>
                <span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slider_3D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slider_4D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slider_5D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="MiniViewer.mem_release">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.data_browser.html#populse_mia.user_interface.data_browser.mini_viewer.MiniViewer.mem_release">[docs]</a>
    <span class="k">def</span> <span class="nf">mem_release</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reset all object lists to zero in order to preserve memory&quot;&quot;&quot;</span>

        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">im_2D</span><span class="p">[:]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">slider_3D</span><span class="p">[:]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">slider_4D</span><span class="p">[:]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">slider_5D</span><span class="p">[:]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">txt_slider_3D</span><span class="p">[:]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">txt_slider_4D</span><span class="p">[:]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">txt_slider_5D</span><span class="p">[:]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">label3D</span><span class="p">[:]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">label4D</span><span class="p">[:]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">label5D</span><span class="p">[:]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">imageLabel</span><span class="p">[:]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[:]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_description</span><span class="p">[:]</span></div>


<div class="viewcode-block" id="MiniViewer.navigImage">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.data_browser.html#populse_mia.user_interface.data_browser.mini_viewer.MiniViewer.navigImage">[docs]</a>
    <span class="k">def</span> <span class="nf">navigImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Display the 2D image for the selected index.</span>

<span class="sd">        :param idx: the selected index</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">indexImage</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">displayPosValue</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image2DModifications</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">im_2D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>

        <span class="n">image</span> <span class="o">=</span> <span class="n">QImage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">im_2D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">QImage</span><span class="o">.</span><span class="n">Format_Indexed8</span><span class="p">)</span>
        <span class="n">pixm</span> <span class="o">=</span> <span class="n">QPixmap</span><span class="o">.</span><span class="n">fromImage</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imageLabel</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setPixmap</span><span class="p">(</span><span class="n">pixm</span><span class="p">)</span></div>


<div class="viewcode-block" id="MiniViewer.openTagsPopUp">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.data_browser.html#populse_mia.user_interface.data_browser.mini_viewer.MiniViewer.openTagsPopUp">[docs]</a>
    <span class="k">def</span> <span class="nf">openTagsPopUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Open a pop-up to select the legend of the thumbnails.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">popUp</span> <span class="o">=</span> <span class="n">PopUpSelectTag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">popUp</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s2">&quot;Select the image viewer tag&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">popUp</span><span class="o">.</span><span class="n">exec_</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verify_slices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_paths</span><span class="p">)</span></div>


<div class="viewcode-block" id="MiniViewer.setThumbnail">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.data_browser.html#populse_mia.user_interface.data_browser.mini_viewer.MiniViewer.setThumbnail">[docs]</a>
    <span class="k">def</span> <span class="nf">setThumbnail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path_base_name</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the thumbnail tag value under the image frame.</span>

<span class="sd">        :param file_path_base_name: basename of the selected path</span>
<span class="sd">        :param idx: index of the image</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Looking for the tag value to display as a legend of the thumbnail</span>
        <span class="k">for</span> <span class="n">scan</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_documents_names</span><span class="p">(</span>
            <span class="n">COLLECTION_CURRENT</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="n">scan</span> <span class="o">==</span> <span class="n">file_path_base_name</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get_value</span><span class="p">(</span>
                    <span class="n">COLLECTION_CURRENT</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getThumbnailTag</span><span class="p">()</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">label_description</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_char_max</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">label_description</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                        <span class="n">data_browser</span><span class="o">.</span><span class="n">not_defined_value</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">nb_char_max</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">label_description</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getThumbnailTag</span><span class="p">())</span>
                <span class="p">)</span></div>


<div class="viewcode-block" id="MiniViewer.show_slices">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.data_browser.html#populse_mia.user_interface.data_browser.mini_viewer.MiniViewer.show_slices">[docs]</a>
    <span class="k">def</span> <span class="nf">show_slices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_paths</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates the thumbnails from the selected file paths.</span>

<span class="sd">        :param file_paths: the selected file paths</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># If it&#39;s the first time that this function is called, the MiniViewer</span>
        <span class="c1"># has to be shown</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_time</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setHidden</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">first_time</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># If the user has willingly hidden the MiniViewer, the Processes are</span>
        <span class="c1"># not made</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isHidden</span><span class="p">():</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">do_nothing</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">file_paths</span> <span class="o">=</span> <span class="n">file_paths</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_scans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get_max_thumbnails</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setMinimumHeight</span><span class="p">(</span><span class="mi">220</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clearLayouts</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">QFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame_final</span> <span class="o">=</span> <span class="n">QFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

            <span class="c1"># Limiting the legend of the thumbnails</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nb_char_max</span> <span class="o">=</span> <span class="mi">60</span>

            <span class="n">font</span> <span class="o">=</span> <span class="n">QFont</span><span class="p">()</span>
            <span class="n">font</span><span class="o">.</span><span class="n">setPointSize</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>

            <span class="c1"># Reading the images from the file paths</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_paths</span><span class="o">.</span><span class="n">copy</span><span class="p">()):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">chk</span> <span class="o">=</span> <span class="n">nib</span><span class="o">.</span><span class="n">as_closest_canonical</span><span class="p">(</span>
                        <span class="n">nib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">mmap</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="c1"># chk = nib.as_closest_canonical(nib.load(file_path))</span>
                    <span class="c1"># chk = nib.load(file_path)</span>

                <span class="k">except</span> <span class="n">nib</span><span class="o">.</span><span class="n">filebasedimages</span><span class="o">.</span><span class="n">ImageFileError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="s2">&quot;Error while trying to display the </span><span class="si">{}</span><span class="s2"> image ...!</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="s2">&quot;Traceback:&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>
                    <span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_tb</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">__traceback__</span><span class="p">)),</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
                    <span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">: </span><span class="si">{1}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">file_paths</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
                    <span class="n">chk</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="s2">&quot;File &quot;</span>
                        <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
                        <span class="o">+</span> <span class="s2">&quot; is not existing ...&quot;</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">file_paths</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
                    <span class="n">chk</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">if</span> <span class="n">chk</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">chk</span><span class="o">.</span><span class="n">dataobj</span><span class="p">)</span>

                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span>
                            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Error while trying to display the </span><span class="si">{}</span><span class="s2"> &quot;</span>
                            <span class="s2">&quot;image ...!</span><span class="se">\n</span><span class="s2">&quot;</span>
                            <span class="s2">&quot;Traceback:&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">file_path</span><span class="p">))</span>
                        <span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span>
                            <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_tb</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">__traceback__</span><span class="p">)),</span>
                            <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">: </span><span class="si">{1}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">file_paths</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">chk</span><span class="p">)</span>

            <span class="c1"># If we are in the &quot;cursors&quot; display mode</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_box_slices</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">:</span>
                <span class="c1"># Layout to aligne each thumbnail (image + cursors)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">h_box_thumb</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>

                <span class="c1"># idx represents the index of the selected image</span>
                <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_scans</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_paths</span><span class="p">))):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_nothing</span><span class="p">[</span><span class="n">idx</span><span class="p">]:</span>
                        <span class="c1"># Creating sliders and labels</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">boxSlider</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">enableSliders</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">createDimensionLabels</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

                        <span class="c1"># Getting the sliders value and reading the image data</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">indexImage</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

                        <span class="c1"># Making some pixel modification to display the image</span>
                        <span class="c1"># correctly</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">image2DModifications</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">displayPosValue</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

                    <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">im_2D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>

                    <span class="n">im_Qt</span> <span class="o">=</span> <span class="n">QImage</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">im_2D</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">QImage</span><span class="o">.</span><span class="n">Format_Indexed8</span>
                    <span class="p">)</span>
                    <span class="n">pixm</span> <span class="o">=</span> <span class="n">QPixmap</span><span class="o">.</span><span class="n">fromImage</span><span class="p">(</span><span class="n">im_Qt</span><span class="p">)</span>

                    <span class="n">file_path_base_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">file_paths</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                    <span class="p">)</span>

                    <span class="c1"># imageLabel is the label where the image is displayed</span>
                    <span class="c1"># (as a pixmap)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">imageLabel</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">imageLabel</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setPixmap</span><span class="p">(</span><span class="n">pixm</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">imageLabel</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="n">file_path_base_name</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">label_description</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">ClickableLabel</span><span class="p">())</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">label_description</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">font</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">label_description</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">openTagsPopUp</span>
                    <span class="p">)</span>

                    <span class="c1"># Looking for the tag value to display as a</span>
                    <span class="c1"># legend of the thumbnail</span>
                    <span class="n">file_path_base_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">file_paths</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setThumbnail</span><span class="p">(</span><span class="n">file_path_base_name</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>

                    <span class="c1"># Layout that corresponds to the 3D dimension</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">h_box_slider_3D</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">h_box_slider_3D</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label3D</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">h_box_slider_3D</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">txt_slider_3D</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">h_box_slider_3D</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slider_3D</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>

                    <span class="c1"># Layout that corresponds to the 4D dimension</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">h_box_slider_4D</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">h_box_slider_4D</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label4D</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">h_box_slider_4D</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">txt_slider_4D</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">h_box_slider_4D</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slider_4D</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>

                    <span class="c1"># Layout that corresponds to the 5D dimension</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">h_box_slider_5D</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">h_box_slider_5D</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label5D</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">h_box_slider_5D</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">txt_slider_5D</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">h_box_slider_5D</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slider_5D</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>

                    <span class="c1"># Layout for the three sliders</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">v_box_sliders</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">v_box_sliders</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_box_slider_3D</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">v_box_sliders</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_box_slider_4D</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">v_box_sliders</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_box_slider_5D</span><span class="p">)</span>

                    <span class="c1"># Layout that corresponds to the image + the sliders</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">h_box</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">h_box</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imageLabel</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">h_box</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_box_sliders</span><span class="p">)</span>

                    <span class="c1"># Layout that corresponds to the image and sliders +</span>
                    <span class="c1"># the description</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">v_box_thumb</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">v_box_thumb</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_box</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">v_box_thumb</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_description</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>

                    <span class="c1"># Layout that will contain all the thumbnails</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">h_box_thumb</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_box_thumb</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_box_thumb</span><span class="p">)</span>

            <span class="c1"># If we are in the &quot;all slices&quot; display mode</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">h_box_images</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">h_box_images</span><span class="o">.</span><span class="n">setSpacing</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">v_box_scans</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>

                <span class="c1"># idx represents the index of the selected image</span>
                <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_paths</span><span class="p">)):</span>
                    <span class="n">file_path_base_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">file_paths</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">folder</span>
                    <span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">label_description</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">ClickableLabel</span><span class="p">())</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">label_description</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">font</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">label_description</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">openTagsPopUp</span>
                    <span class="p">)</span>

                    <span class="c1"># Looking for the tag value to display as a legend</span>
                    <span class="c1"># of the thumbnail</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setThumbnail</span><span class="p">(</span><span class="n">file_path_base_name</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>

                    <span class="c1"># Depending of the dimension of the image,</span>
                    <span class="c1"># the legend of each image and the number of images to</span>
                    <span class="c1"># display will change</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_nothing</span><span class="p">[</span><span class="n">idx</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                            <span class="n">nb_slices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                            <span class="n">txt</span> <span class="o">=</span> <span class="s2">&quot;Slice n°&quot;</span>
                        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                            <span class="n">nb_slices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                            <span class="n">txt</span> <span class="o">=</span> <span class="s2">&quot;Time n°&quot;</span>
                        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                            <span class="n">nb_slices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                            <span class="n">txt</span> <span class="o">=</span> <span class="s2">&quot;Study n°&quot;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">nb_slices</span> <span class="o">=</span> <span class="mi">0</span>

                        <span class="c1"># Limiting the number of images to the number</span>
                        <span class="c1"># chosen by the user</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
                            <span class="nb">min</span><span class="p">(</span>
                                <span class="n">nb_slices</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line_edit_nb_slices</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                            <span class="p">)</span>
                        <span class="p">):</span>
                            <span class="n">pixm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_to_pixmap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">i</span><span class="p">)</span>

                            <span class="bp">self</span><span class="o">.</span><span class="n">v_box</span> <span class="o">=</span> <span class="n">QVBoxLayout</span><span class="p">()</span>

                            <span class="c1"># label corresponds to the label where one image</span>
                            <span class="c1"># is displayed</span>
                            <span class="n">label</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                            <span class="n">label</span><span class="o">.</span><span class="n">setPixmap</span><span class="p">(</span><span class="n">pixm</span><span class="p">)</span>
                            <span class="n">label</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span>
                                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_paths</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
                            <span class="p">)</span>

                            <span class="c1"># Legend of the image (depends on the number</span>
                            <span class="c1"># of dimensions)</span>
                            <span class="n">label_info</span> <span class="o">=</span> <span class="n">QLabel</span><span class="p">()</span>
                            <span class="n">label_info</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="n">font</span><span class="p">)</span>
                            <span class="n">label_info</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">txt</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                            <span class="n">label_info</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>

                            <span class="bp">self</span><span class="o">.</span><span class="n">v_box</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">v_box</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">label_info</span><span class="p">)</span>

                            <span class="c1"># This layout allows to chain each image</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">h_box_images</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_box</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">v_box_scans</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_box_images</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">v_box_scans</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_description</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_box_scans</span><span class="p">)</span>

            <span class="c1"># Adding a scroll area if the thumbnails are too large</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scroll_area</span> <span class="o">=</span> <span class="n">QScrollArea</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scroll_area</span><span class="o">.</span><span class="n">setWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">h_box_check_box</span> <span class="o">=</span> <span class="n">QHBoxLayout</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_box_slices</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">h_box_check_box</span><span class="o">.</span><span class="n">addStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">h_box_check_box</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_orientation</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">h_box_check_box</span><span class="o">.</span><span class="n">addStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">label_nb_slices</span><span class="o">.</span><span class="n">setHidden</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">line_edit_nb_slices</span><span class="o">.</span><span class="n">setHidden</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">h_box_check_box</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_nb_slices</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">h_box_check_box</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line_edit_nb_slices</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">check_box_cursors</span><span class="o">.</span><span class="n">setHidden</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">check_box_cursors</span><span class="o">.</span><span class="n">setHidden</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">h_box_check_box</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">check_box_cursors</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">h_box_check_box</span><span class="o">.</span><span class="n">addStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">h_box_check_box</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_orientation</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">h_box_check_box</span><span class="o">.</span><span class="n">addStretch</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">label_nb_slices</span><span class="o">.</span><span class="n">setHidden</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">line_edit_nb_slices</span><span class="o">.</span><span class="n">setHidden</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">h_box_check_box</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">check_box_slices</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">v_box_final</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_box_check_box</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">v_box_final</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scroll_area</span><span class="p">)</span></div>


<div class="viewcode-block" id="MiniViewer.update_nb_slices">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.data_browser.html#populse_mia.user_interface.data_browser.mini_viewer.MiniViewer.update_nb_slices">[docs]</a>
    <span class="k">def</span> <span class="nf">update_nb_slices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the config file and the thumbnails.</span>

<span class="sd">        Called when the number of slices to visualize changes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nb_slices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_edit_nb_slices</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setNbAllSlicesMax</span><span class="p">(</span><span class="n">nb_slices</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_slices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_paths</span><span class="p">)</span></div>


<div class="viewcode-block" id="MiniViewer.update_visualization_method">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.data_browser.html#populse_mia.user_interface.data_browser.mini_viewer.MiniViewer.update_visualization_method">[docs]</a>
    <span class="k">def</span> <span class="nf">update_visualization_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the config file and the thumbnails.</span>

<span class="sd">        Called when the state of the checkbox to show all slices changes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_box_slices</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setShowAllSlices</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_box_slices</span><span class="o">.</span><span class="n">checkState</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setShowAllSlices</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify_slices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_paths</span><span class="p">)</span></div>


<div class="viewcode-block" id="MiniViewer.verify_slices">
<a class="viewcode-back" href="../../../../populse_mia.user_interface.data_browser.html#populse_mia.user_interface.data_browser.mini_viewer.MiniViewer.verify_slices">[docs]</a>
    <span class="k">def</span> <span class="nf">verify_slices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_paths</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Make &#39;Show all slices&#39; checkbox unclickable if len(file_paths) &gt; 1.</span>

<span class="sd">        :param file_paths: the selected documents</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Updating the config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mem_release</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setShowAllSlices</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_box_slices</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_box_slices</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_box_slices</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_slices</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">isRadioView</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label_orientation</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Radiological orientation&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label_orientation</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Neurological orientation&quot;</span><span class="p">)</span></div>
</div>


    <span class="c1"># def check_differences(self, file_paths):</span>
    <span class="c1">#     old_to_new = []</span>
    <span class="c1">#     self.do_nothing = [False, False, False]</span>
    <span class="c1">#     for idx_old, file_path in enumerate(self.file_paths):</span>
    <span class="c1">#         if file_path in file_paths:</span>
    <span class="c1">#             idx_new = file_paths.index(file_path)</span>
    <span class="c1">#             old_to_new.append((idx_old, idx_new))</span>
    <span class="c1">#             #if idx_new == idx_old:</span>
    <span class="c1">#             self.do_nothing[idx_new] = True</span>
    <span class="c1">#</span>
    <span class="c1">#     for tp in old_to_new:</span>
    <span class="c1">#         idx_old = tp[0]</span>
    <span class="c1">#         idx_new = tp[1]</span>
    <span class="c1">#         self.shift_thumbnail(idx_old, idx_new)</span>
    <span class="c1">#</span>
    <span class="c1"># def shift_thumbnail(self, idx_old, idx_new):</span>
    <span class="c1">#</span>
    <span class="c1">#     self.im_2D[idx_new] = self.im_2D[idx_old]</span>
    <span class="c1">#</span>
    <span class="c1">#     self.slider_3D[idx_new].setMaximum(self.slider_3D[idx_old].maximum())</span>
    <span class="c1">#     self.slider_4D[idx_new].setMaximum(self.slider_4D[idx_old].maximum())</span>
    <span class="c1">#     self.slider_5D[idx_new].setMaximum(self.slider_5D[idx_old].maximum())</span>
    <span class="c1">#</span>
    <span class="c1">#     self.slider_3D[idx_new].setValue(self.slider_3D[idx_old].value())</span>
    <span class="c1">#     self.slider_4D[idx_new].setValue(self.slider_4D[idx_old].value())</span>
    <span class="c1">#     self.slider_5D[idx_new].setValue(self.slider_5D[idx_old].value())&quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="c1"># def clear_layout(self, layout):</span>
    <span class="c1">#     while layout.count() &gt; 0:</span>
    <span class="c1">#         item = layout.takeAt(0)</span>
    <span class="c1">#         if not item:</span>
    <span class="c1">#             continue</span>
    <span class="c1">#</span>
    <span class="c1">#         w = item.widget()</span>
    <span class="c1">#         if w:</span>
    <span class="c1">#             w.deleteLater()&quot;&quot;&quot;</span>
</pre></div>

      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        <a class="uplink" href="../../../../index.html">Contents</a>
        </p>

      </div>

    <div class="footer" role="contentinfo">
    &#169; Copyright 2022, populse.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>
  </body>
</html>