import{_ as F,K as G,L as H,A as h,S as f,E as T,r as i,o as d,c as p,b as s,w as o,a as n,F as g,d as k,s as U,v as x,t as z,x as C,H as M,I as K}from"./index-1ad0aa26.js";import{d as w}from"./dateUtils-a37efffc.js";const O={components:{ElMessageBox:G,Timer:H},data(){return{dialogVisible:!1,taskValue:"",taskType:"",taskName:"",taskArgs:"",run_date:"",interval_week:0,interval_day:0,interval_hour:0,interval_minute:0,interval_second:0,interval_date:"",taskList:[],TaskTableData:[],apschedulerTypesDate:!1,apschedulerTypesInterval:!1,apschedulerTypes:[{value:"date",label:"日期"},{value:"interval",label:"间隔"}],defaultTime:new Date}},created(){this.GetApschedulerTask(),this.GetSysApschedulerTaskList()},watch:{taskType(a,l){a==="date"&&(this.apschedulerTypesDate=!0,this.apschedulerTypesInterval=!1),a==="interval"&&(this.apschedulerTypesInterval=!0,this.apschedulerTypesDate=!1)}},methods:{handleStr(a){return a.trim().trim(`
`)},GetApschedulerTask(){h.get(f.sys_apscheduler,{get_apscheduler_handler_info:!0}).then(({data:a})=>{Object.keys(a.data).forEach(r=>{let _=this.handleStr(a.data[r]);this.taskList.push({value:r,label:_})})})},GetSysApschedulerTaskList(){h.get(f.sys_apscheduler).then(({data:a})=>{console.log("....",a),this.TaskTableData=a.data})},CreateApschedulerTaskHandler(){this.dialogVisible=!1;let a={types:this.taskType,name:this.taskName,func:this.taskValue,args:this.taskArgs};this.apschedulerTypesDate===!0?a.run_date=w.formatDateStr2Format(this.run_date):(a.weeks=this.interval_week,a.days=this.interval_day,a.hours=this.interval_hour,a.minutes=this.interval_minute,a.seconds=this.interval_second,a.start_date=w.formatDateStr2Format(this.interval_date[0]),a.end_date=w.formatDateStr2Format(this.interval_date[1])),h.post(f.sys_apscheduler,a).then(({data:l})=>{l.code===200?this.TaskTableData.unshift(l.data[0]):T.error(l.msg)})},handleTableEdit(a,l){let r={action:"resume"};l.pending!==!0&&(r.action="pause"),h.put(f.sys_apscheduler,r,{job_id:l.job_id}).then(({data:_})=>{_.code===200?this.TaskTableData[a]=_.data[0]:T.error("操作任务失败")})},handleTableDelete(a,l){h.delete(f.sys_apscheduler,void 0,{job_id:l.job_id}).then(({data:r})=>{r.code===200?this.TaskTableData.splice(a,1):T.error("删除任务失败")})}}},u=a=>(M("data-v-373a080a"),a=a(),K(),a),q={class:"apscheduler-info"},J={class:"apscheduler-config-info"},P={class:"apscheduler-config-detail"},Q={key:0,class:"apscheduler-config-detail-args"},R=u(()=>n("span",null,"任务执行时间 ",-1)),W=u(()=>n("span",null,"任务参数 ",-1)),X={key:1,class:"apscheduler-config-detail-args"},Y=u(()=>n("span",null,"开始时间&结束时间 ",-1)),Z=u(()=>n("span",null,"间隔：周 ",-1)),$=u(()=>n("span",null,"间隔：日 ",-1)),ee=u(()=>n("span",null,"间隔：小时 ",-1)),le=u(()=>n("span",null,"间隔：分钟 ",-1)),te=u(()=>n("span",null,"间隔：秒 ",-1)),ae=u(()=>n("span",null,"任务参数 ",-1)),se={class:"dialog-footer"},ne={style:{display:"flex","align-items":"center"}},oe={key:0,style:{"margin-left":"10px"}},ie={key:1,style:{"margin-left":"10px"}};function de(a,l,r,_,t,y){const D=i("el-option"),A=i("el-select"),V=i("el-col"),b=i("el-input"),I=i("el-row"),S=i("el-date-picker"),m=i("el-input-number"),c=i("el-button"),N=i("el-dialog"),v=i("el-table-column"),j=i("timer"),E=i("el-icon"),L=i("el-table");return d(),p(g,null,[s(N,{modelValue:t.dialogVisible,"onUpdate:modelValue":l[13]||(l[13]=e=>t.dialogVisible=e),title:"创建定时任务",width:"50%"},{footer:o(()=>[n("span",se,[s(c,{onClick:l[12]||(l[12]=e=>t.dialogVisible=!1)},{default:o(()=>[k("取 消")]),_:1}),s(c,{type:"primary",onClick:y.CreateApschedulerTaskHandler},{default:o(()=>[k(" 确 认 ")]),_:1},8,["onClick"])])]),default:o(()=>[n("div",q,[n("div",J,[s(I,null,{default:o(()=>[s(V,{span:8},{default:o(()=>[s(A,{modelValue:t.taskValue,"onUpdate:modelValue":l[0]||(l[0]=e=>t.taskValue=e),filterable:"",placeholder:"选择任务"},{default:o(()=>[(d(!0),p(g,null,U(t.taskList,e=>(d(),C(D,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(V,{span:8},{default:o(()=>[s(A,{modelValue:t.taskType,"onUpdate:modelValue":l[1]||(l[1]=e=>t.taskType=e),class:"m-2",placeholder:"选择定时类型"},{default:o(()=>[(d(!0),p(g,null,U(t.apschedulerTypes,e=>(d(),C(D,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(V,{span:8},{default:o(()=>[s(b,{modelValue:t.taskName,"onUpdate:modelValue":l[2]||(l[2]=e=>t.taskName=e),placeholder:"定时任务别名"},null,8,["modelValue"])]),_:1})]),_:1})]),n("div",P,[t.apschedulerTypesDate?(d(),p("div",Q,[n("li",null,[R,s(S,{modelValue:t.run_date,"onUpdate:modelValue":l[3]||(l[3]=e=>t.run_date=e),type:"datetime",placeholder:"任务执行时间","default-time":t.defaultTime},null,8,["modelValue","default-time"])]),n("li",null,[W,s(b,{modelValue:t.taskArgs,"onUpdate:modelValue":l[4]||(l[4]=e=>t.taskArgs=e),placeholder:"多个参数使用&隔开"},null,8,["modelValue"])])])):x("",!0),t.apschedulerTypesInterval?(d(),p("div",X,[n("li",null,[Y,s(S,{modelValue:t.interval_date,"onUpdate:modelValue":l[5]||(l[5]=e=>t.interval_date=e),type:"datetimerange","start-placeholder":"开始时间","end-placeholder":"结束时间","default-time":t.defaultTime},null,8,["modelValue","default-time"])]),n("li",null,[Z,s(m,{modelValue:t.interval_week,"onUpdate:modelValue":l[6]||(l[6]=e=>t.interval_week=e),min:0},null,8,["modelValue"])]),n("li",null,[$,s(m,{modelValue:t.interval_day,"onUpdate:modelValue":l[7]||(l[7]=e=>t.interval_day=e),min:0},null,8,["modelValue"])]),n("li",null,[ee,s(m,{modelValue:t.interval_hour,"onUpdate:modelValue":l[8]||(l[8]=e=>t.interval_hour=e),min:0},null,8,["modelValue"])]),n("li",null,[le,s(m,{modelValue:t.interval_minute,"onUpdate:modelValue":l[9]||(l[9]=e=>t.interval_minute=e),min:0},null,8,["modelValue"])]),n("li",null,[te,s(m,{modelValue:t.interval_second,"onUpdate:modelValue":l[10]||(l[10]=e=>t.interval_second=e),min:0},null,8,["modelValue"])]),n("li",null,[ae,s(b,{modelValue:t.taskArgs,"onUpdate:modelValue":l[11]||(l[11]=e=>t.taskArgs=e),placeholder:"多个参数使用&隔开"},null,8,["modelValue"])])])):x("",!0)])])]),_:1},8,["modelValue"]),n("div",null,[s(L,{data:t.TaskTableData,style:{width:"100%"}},{default:o(()=>[s(v,{prop:"job_id",label:"任务id","min-width":"100"}),s(v,{prop:"job_name",label:"任务名称","min-width":"100"}),s(v,{label:"任务状态","min-width":"100"},{default:o(e=>[n("div",ne,[s(E,null,{default:o(()=>[s(j)]),_:1}),e.row.pending?(d(),p("span",ie,"已暂停")):(d(),p("span",oe,"已启动"))])]),_:1}),s(v,{align:"right"},{header:o(()=>[s(c,{type:"primary",plain:"",onClick:l[14]||(l[14]=e=>t.dialogVisible=!0)},{default:o(()=>[k(" 创建定时任务 ")]),_:1})]),default:o(e=>[s(c,{size:"small",onClick:B=>y.handleTableEdit(e.$index,e.row)},{default:o(()=>[k(z(e.row.pending===!0?"启 动":"暂 停"),1)]),_:2},1032,["onClick"]),s(c,{size:"small",type:"danger",onClick:B=>y.handleTableDelete(e.$index,e.row)},{default:o(()=>[k("删 除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])])],64)}const pe=F(O,[["render",de],["__scopeId","data-v-373a080a"]]);export{pe as default};
