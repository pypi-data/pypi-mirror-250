import{A as w,bp as d,a as v,b as f,c as k,o as c,e as p,w as i,i as h,t as _,g as r,D as P,f as y,C as S,at as T,d as b,bq as Ce,br as ye,j as s,aC as W,bo as Z,bs as Re,bt as Te,bu as Be,bv as De,bw as Ie,bx as ee,r as V,by as te,F as R,bz as oe,aG as F,bh as O,be as $e,bA as Le,b5 as U,bB as Ve,bC as Oe,bD as Ee,bE as xe,n as E,aD as Ae,aU as Ne,bF as We,Y as Ue,U as ze,W as B,aw as z,aW as M,ay as Fe,az as Me,bG as Ge,bH as He,bI as qe,bJ as Ke,bK as je,l as G,bL as I,bM as N,b0 as H,bN as Ye,bO as Xe,bP as Je,bQ as Qe,bR as Ze,bS as et,bT as tt,bU as ot,bV as at,p as st,q as nt,V as q,bn as ae,B as K,bm as rt,bW as it,bk as j,bX as lt}from"./admin-eKzY3vzh.js";import{_ as x,a as se,b as ne,P as ct,c as re}from"./metadata-dialog-LCLm-ZqL.js";const dt={name:"ReaderNavButton",components:{PaginationNavButton:x},props:{value:{type:Number,required:!0},twoPages:{type:Boolean,default:!1}},computed:{...w(d,["isVertical"]),...v(d,{storePage:e=>e.page,toRoute(e){if(!this.isVertical)return{params:{pk:e.books.current.pk,page:this.value}}}}),title(){return"to page "+this.value},disabled(){return this.value===this.storePage||this.twoPages&&!!(this.value%2)&&this.value-1===this.storePage}},methods:{...f(d,["setActivePage"]),onClick(){this.isVertical&&this.setActivePage(this.value,!0)}}};function ut(e,t,a,u,l,o){const n=x;return c(),p(n,{key:e.isVertical,disabled:o.disabled,title:o.title,to:e.toRoute,onClick:o.onClick},{default:i(()=>[h(_(a.value),1)]),_:1},8,["disabled","title","to","onClick"])}const ie=k(dt,[["render",ut]]),gt={name:"ReaderBookChangeNavButton",components:{PaginationNavButton:x},props:{direction:{type:String,required:!0}},computed:{...w(d,["isBTT"]),...v(d,{toRoute(e){var a;const t=(a=e==null?void 0:e.routes)==null?void 0:a.books[this.direction];return t?{params:{...t}}:""}}),title(){return(this.direction==="prev"?"Previous":"Next")+" Book"},icon(){return this.bookChangeIcon(this.direction)},disabled(){return!this.toRoute}},methods:{...f(d,["bookChangeIcon"])}};function ht(e,t,a,u,l,o){const n=x;return c(),p(n,{icon:"",variant:"plain",disabled:o.disabled,title:o.title,to:e.toRoute},{default:i(()=>[r(P,null,{default:i(()=>[h(_(o.icon),1)]),_:1})]),_:1},8,["disabled","title","to"])}const le=k(gt,[["render",ht]]),$="prev",L="next",pt={name:"ReaderNavToolbar",components:{PaginationSlider:se,ReaderNavButton:ie,PaginationToolbar:ne,ReaderBookChangeNavButton:le},computed:{...w(d,["activeSettings","isReadInReverse","isVertical"]),...v(d,{storePage:e=>e.page,key(e){var t,a;return`${(a=(t=e.books)==null?void 0:t.current)==null?void 0:a.pk}:${this.step}:${this.isReadInReverse}`},maxPage:e=>{var t,a;return((a=(t=e.books)==null?void 0:t.current)==null?void 0:a.maxPage)||0}}),twoPages(){return this.activeSettings.twoPages},step(){return this.activeSettings.twoPages?2:1},trackColor(){return this.twoPages&&+this.storePage>=this.maxPage-1?this.$vuetify.theme.current.colors.primary:""},min(){return this.isReadInReverse?this.maxPage:0},max(){return this.isReadInReverse?0:this.maxPage},bookPrev(){return this.isReadInReverse?"next":"prev"},bookNext(){return this.isReadInReverse?"prev":"next"}},mounted(){document.addEventListener("keyup",this._keyListener)},beforeUnmount(){document.removeEventListener("keyup",this._keyListener)},methods:{...f(d,["routeToBook","routeToDirection","routeToDirectionOne","routeToPage","setActivePage"]),onSliderUpdate(e){this.isVertical?this.setActivePage(e,!0):this.routeToPage(e)},_keyListener(e){switch(e.stopPropagation(),e.key){case" ":!e.shiftKey&&window.innerHeight+window.scrollY+1>=document.body.scrollHeight?this.routeToDirection(L):e.shiftKey&&window.scrollY===0&&this.routeToDirection($);break;case"j":case"ArrowRight":this.routeToDirection(L);break;case"k":case"ArrowLeft":this.routeToDirection($);break;case",":this.routeToDirectionOne($);break;case".":this.routeToDirectionOne(L);break;case"n":this.routeToBook(L);break;case"p":this.routeToBook($);break}}}};function mt(e,t,a,u,l,o){const n=le,g=ie,m=se,D=ne;return e.maxPage?(c(),p(D,{key:0},{default:i(()=>[r(n,{direction:o.bookPrev},null,8,["direction"]),r(g,{value:o.min,"two-pages":o.twoPages},null,8,["value","two-pages"]),(c(),p(m,{key:e.key,"model-value":e.storePage,min:0,max:e.maxPage,step:o.step,"track-color":o.trackColor,reverse:e.isReadInReverse,"onUpdate:modelValue":t[0]||(t[0]=A=>o.onSliderUpdate(A))},null,8,["model-value","max","step","track-color","reverse"])),r(g,{value:o.max,"two-pages":o.twoPages},null,8,["value","two-pages"]),r(n,{direction:o.bookNext},null,8,["direction"])]),_:1})):y("",!0)}const ce=k(pt,[["render",mt]]),kt={name:"PageChangeLink",props:{direction:{type:String,required:!0}},head(){return this.prefetchLinks(this.params,this.computedDirection)},computed:{...w(d,["isVertical","isFirstPage","isLastPage"]),...v(d,{params(e){return e.routes[this.computedDirection]}}),computedDirection(){return this.normalizeDirection(this.direction)},show(){return this.computedDirection==="prev"?!this.isFirstPage:!this.isLastPage},pageChangeClass(){let e="pageChange";return e+=this.isVertical?"Row":"Column",e},directionClass(){let e=this.direction;return this.isVertical&&(e+="Vertical"),e},route(){return this.toRoute(this.params)},label(){return this.linkLabel(this.computedDirection,"Page")}},methods:{...f(d,["getSettings","linkLabel","normalizeDirection","prefetchLinks","toRoute"])}};function _t(e,t,a,u,l,o){const n=S("router-link");return o.show?(c(),p(n,{key:0,to:o.route,"aria-label":o.label,class:T({[o.pageChangeClass]:!0,[o.directionClass]:!0}),onClick:t[0]||(t[0]=g=>g.stopImmediatePropagation())},null,8,["to","aria-label","class"])):y("",!0)}const de=k(kt,[["render",_t],["__scopeId","data-v-0e94dc39"]]),bt={name:"LoadingPage",components:{Placeholder:ct},props:{twoPages:{type:Boolean,required:!0}}};function ft(e,t,a,u,l,o){const n=S("Placeholder");return c(),b("div",{class:T(["pageLoading",{twoPages:a.twoPages}])},[r(n,{class:"pagePlaceholder"})],2)}const vt=k(bt,[["render",ft],["__scopeId","data-v-13c9bf0b"]]),Y="unauthorized",Pt={name:"ErrorPage",props:{twoPages:{type:Boolean,required:!0},type:{type:String,required:!0}},computed:{text(){return this.type===Y?"Protected page":"Failed to load page"},icon(){return this.type===Y?Ce:ye}}},wt={class:"pageErrorContainer"},St={class:"pageErrorText"};function Ct(e,t,a,u,l,o){return c(),b("div",{class:T(["pageError",{twoPages:a.twoPages}])},[s("div",wt,[s("div",St,_(o.text),1),r(P,{class:"pageErrorIcon"},{default:i(()=>[h(_(o.icon),1)]),_:1})])],2)}const yt=k(Pt,[["render",Ct],["__scopeId","data-v-3f1e3f4f"]]),Rt={name:"ImgPage",props:{src:{type:String,required:!0},fitToClass:{type:Object,required:!0}},emits:["load","error"]},Tt=["src"];function Bt(e,t,a,u,l,o){return c(),b("img",W({class:a.fitToClass,src:a.src},e.$attrs,{onError:t[0]||(t[0]=n=>e.$emit("error")),onLoad:t[1]||(t[1]=n=>e.$emit("load"))}),null,16,Tt)}const X=k(Rt,[["render",Bt],["__scopeId","data-v-aacefbb6"]]),J=Z(Re(()=>Ie(()=>import("./page-pdf-8DCW311Z.js"),__vite__mapDeps([0,1,2,3])))),Dt=333,It={S:"Screen",W:"Width",H:"Height",O:"Original"},$t={name:"BookPage",components:{ErrorPage:yt,LoadingPage:vt,PDFPage:J,ImgPage:X},props:{book:{type:Object,required:!0},page:{type:Number,required:!0}},data(){return{showProgress:!1,loaded:!1,error:!1}},computed:{...w(d,["isVertical"]),pageClass(){return this.isVertical?"pageVertical":"pageHorizontal"},fitToClass(){let e={};const t=It[this.settings.fitTo];if(t){let a="fitTo";a+=Te(t),this.isVertical?a+="Vertical":this.settings.twoPages&&(a+="Two"),e[a]=!0}return e},src(){const e={pk:this.book.pk,page:this.page};return Be(e)},component(){return this.book.fileType==="PDF"?J:X},settings(){return this.getSettings(this.book)}},mounted(){setTimeout(function(){this.loaded||(this.loading=!0)},Dt)},methods:{...f(d,["getSettings"]),onLoad(){this.showProgress=!1,this.loaded=!0,this.error=!1},onError(){this.error="load",this.showProgress=!1},onUnauthorized(){this.error="unauthorized",this.showProgress=!1}}},Lt=["id","data-page"];function Vt(e,t,a,u,l,o){const n=S("ErrorPage"),g=S("LoadingPage");return c(),b("div",{id:`page${a.page}`,"data-page":a.page,class:T(o.pageClass)},[l.error?(c(),p(n,{key:0,"two-pages":o.settings.twoPages,type:l.error},null,8,["two-pages","type"])):l.showProgress&&!l.loaded?(c(),p(g,{key:1,"two-pages":o.settings.twoPages},null,8,["two-pages"])):(c(),p(De(o.component),{key:2,src:o.src,"fit-to-class":o.fitToClass,book:a.book,onError:o.onError,onLoad:o.onLoad,onUnauthorized:o.onUnauthorized},null,40,["src","fit-to-class","book","onError","onLoad","onUnauthorized"]))],10,Lt)}const ue=k($t,[["render",Vt],["__scopeId","data-v-fd17f708"]]),Ot=48,Et=48,xt={name:"PagesHorizontalWindow",components:{BookPage:ue,PageChangeLink:de},props:{book:{type:Object,required:!0}},data(){return{activePage:0,pages:[]}},computed:{...w(d,["isOnCoverPage","isReadInReverse"]),...v(d,{prevBook:e=>{var t;return(t=e.routes.books)==null?void 0:t.prev},nextBook:e=>{var t;return(t=e.routes.books)==null?void 0:t.next},storePage:e=>e.page,storePk:e=>e.books.current.pk}),settings(){return this.getSettings(this.book)},twoPages(){return this.settings.twoPages},secondPage(){return this.settings.twoPages&&!this.isOnCoverPage},windowIndex(){const e=this.activePage-this.pages[0];return Math.min(Math.max(0,e),this.book.maxPage)}},watch:{twoPages(){this.setActivePage(this.storePage,!0)},storePage(e){if(this.book.pk===this.storePk){this.activePage=e;const t=this.pages.at(0),a=this.pages.at(-1);(e<t||e>a)&&this.setPages()}},prevBook(e){this.book.pk===e.pk&&(this.activePage=this.book.maxPage)},nextBook(e){this.book.pk===e.pk&&(this.activePage=0)}},created(){this.book.pk===this.storePk?this.activePage=+this.$route.params.page:this.book.pk===this.prevBook.pk?this.activePage=this.book.maxPage:this.activePage=0,this.setPages()},methods:{...f(d,["getSettings","setBookChangeFlag","setActivePage"]),setPages(){const e=Math.max(this.activePage-Ot,0),t=Math.min(this.activePage+Et,this.book.maxPage),a=ee.range(e,t+1);this.pages=a}}};function At(e,t,a,u,l,o){const n=de,g=S("BookPage");return c(),p(oe,{"show-arrows":"",continuous:"","model-value":o.windowIndex,reverse:e.isReadInReverse},{prev:i(()=>[r(n,{direction:"prev"})]),next:i(()=>[r(n,{direction:"next"})]),default:i(()=>[(c(!0),b(R,null,V(l.pages,m=>(c(),p(te,{key:`c/${a.book.pk}/${m}`,class:"windowItem",disabled:"",eager:m>=e.storePage-1&&m<=e.storePage+2,"model-value":m,transition:!0},{default:i(()=>[!e.isReadInReverse||o.secondPage&&m<a.book.maxPage?(c(),p(g,{key:0,book:a.book,page:e.isReadInReverse?m+1:m},null,8,["book","page"])):y("",!0),e.isReadInReverse||o.secondPage&&m<a.book.maxPage?(c(),p(g,{key:1,book:a.book,page:e.isReadInReverse?m:m+1},null,8,["book","page"])):y("",!0)]),_:2},1032,["eager","model-value"]))),128))]),_:1},8,["model-value","reverse"])}const Nt=k(xt,[["render",At],["__scopeId","data-v-6b3913a8"]]);function ge(e,t){const{self:a=!1}=t.modifiers??{},u=t.value,l=typeof u=="object"&&u.options||{passive:!0},o=typeof u=="function"||"handleEvent"in u?u:u.handler,n=a?e:t.arg?document.querySelector(t.arg):window;n&&(n.addEventListener("scroll",o,l),e._onScroll=Object(e._onScroll),e._onScroll[t.instance.$.uid]={handler:o,options:l,target:a?void 0:n})}function he(e,t){var o;if(!((o=e._onScroll)!=null&&o[t.instance.$.uid]))return;const{handler:a,options:u,target:l=e}=e._onScroll[t.instance.$.uid];l.removeEventListener("scroll",a,u),delete e._onScroll[t.instance.$.uid]}function Wt(e,t){t.value!==t.oldValue&&(he(e,t),ge(e,t))}const Ut={mounted:ge,unmounted:he,updated:Wt},zt=12,Q=250,Ft={name:"PagesVerticalScroller",components:{BookPage:ue},props:{book:{type:Object,required:!0}},data(){return{innerHeight:window.innerHeight,innerWidth:window.innerWidth,intersectorOn:!1,programmaticScroll:!1}},computed:{...v(d,{storePage:e=>e.page}),...F(d,["reactWithScroll"]),settings(){return this.getSettings(this.book)},readInReverse(){return this.settings.readInReverse},items(){var a;const e=((a=this.book)==null?void 0:a.maxPage)+1,t=ee.range(0,e);return this.readInReverse&&t.reverse(),t},visibleItems(){var e;return Math.min(((e=this.book)==null?void 0:e.maxPage)??0,zt)}},watch:{storePage(e){this.reactWithScroll&&this.scrollToPage(e)}},mounted(){window.addEventListener("resize",this.onResize),setTimeout(()=>{this.scrollToPage(this.storePage)},Q)},beforeUnmount(){window.removeEventListener("resize",this.onResize)},methods:{...f(d,["setActivePage","setBookChangeFlag","getSettings"]),onIntersect(e,t){if(e&&this.intersectorOn){const u=+t[0].target.dataset.page;this.setActivePage(u,!1)}},onScroll(){if(this.programmaticScroll)return;this.intersectorOn=!0;const e=this.$refs.verticalScroll.$el,t=e.scrollTop;if(this.storePage===0&&t===0)this.setBookChangeFlag("prev");else if(this.storePage===this.book.maxPage){const a=e.scrollTopMax||e.scrollHeight-e.clientTop;window.innerHeight+t+1>=a&&this.setBookChangeFlag("next")}},scrollToPage(e){this.intersectorOn=!1,this.programmaticScroll=!0;const t=this.$refs.verticalScroll;t?t.scrollToIndex(e):console.debug("Can't find verticalScroll component."),setTimeout(()=>{this.programmaticScroll=!1},Q)},onResize(){this.innerHeight=window.innerHeight,this.innerWidth=window.innerWidth}}},Mt=["data-page"];function Gt(e,t,a,u,l,o){const n=S("BookPage");return O((c(),p(Le,{id:"verticalScroll",key:o.readInReverse,ref:"verticalScroll",items:o.items,height:l.innerHeight,width:l.innerWidth},{default:i(({item:g})=>[r(n,{book:a.book,page:g},null,8,["book","page"]),O(s("div",{class:"pageTracker","data-page":g},null,8,Mt),[[$e,{handler:o.onIntersect,options:{threshold:[.75]}},void 0,{quiet:!0}]])]),_:1},8,["items","height","width"])),[[Ut,o.onScroll,"#verticalScroll"]])}const Ht=k(Ft,[["render",Gt],["__scopeId","data-v-fe4dec31"]]),qt={name:"PagesView",components:{PagesHorizontalWindow:Nt,PagesVerticalScroller:Ht},props:{book:{type:Object,required:!0}},emits:["click"],computed:{...w(d,["isVertical"]),...v(d,{storePk:e=>{var t,a;return((a=(t=e.books)==null?void 0:t.current)==null?void 0:a.pk)||0}})},watch:{$route(e){+e.params.pk===this.book.pk&&this.setActivePage(+e.params.page,!0)}},created(){this.book.pk===this.storePk&&this.setActivePage(+this.$route.params.page,!0)},methods:{...f(d,["setActivePage"])}};function Kt(e,t,a,u,l,o){const n=S("PagesVerticalScroller"),g=S("PagesHorizontalWindow");return e.isVertical?(c(),p(n,{key:0,book:a.book,onClick:e.$emit.click},null,8,["book","onClick"])):(c(),p(g,{key:1,book:a.book,onClick:e.$emit.click},null,8,["book","onClick"]))}const pe=k(qt,[["render",Kt]]),jt={name:"BookChangeActivator",props:{direction:{type:String,required:!0}},computed:{computedDirection(){return this.normalizeDirection(this.direction)},positionClass(){return this.bookChangeLocation(this.direction)+"Pos"},cursorClass(){return this.bookChangeCursorClass(this.direction)},show(){return this.bookChangeShow(this.computedDirection)}},methods:{...f(d,["setBookChangeFlag","normalizeDirection","bookChangeLocation","bookChangeCursorClass","bookChangeShow"])}};function Yt(e,t,a,u,l,o){return o.show?(c(),b("div",{key:0,class:T(["bookChangeColumn",{[o.positionClass]:!0,[o.cursorClass]:!0}]),onClick:t[0]||(t[0]=U(n=>e.setBookChangeFlag(a.direction),["stop"]))},null,2)):y("",!0)}const me=k(jt,[["render",Yt],["__scopeId","data-v-2b81f2ae"]]),Xt={name:"BooksWindow",components:{BookChangeActivator:me,PagesView:pe},emits:["click"],computed:{...w(d,["isBTT"]),...v(d,{books:e=>[e.books.prev,e.books.current,e.books.next].filter(Boolean),bookChange:e=>e.bookChange,currentBookPk:e=>{var t,a;return((a=(t=e.books)==null?void 0:t.current)==null?void 0:a.pk)||0},bookRoutes:e=>e.routes.books})},watch:{$route(e,t){(!t||!t.params||+e.params.pk!=+t.params.pk)&&this.loadBooks(e.params)}},beforeMount(){this.setBookChangeFlag(),this.loadBooks(this.$route.params)},methods:{...f(d,["setBookChangeFlag","loadBooks"]),click(){this.setBookChangeFlag(),this.$emit("click")},eager(e){return this.bookChange&&this.bookRoutes[this.bookChange]&&this.bookRoutes[this.bookChange].pk===e}}};function Jt(e,t,a,u,l,o){const n=me,g=pe;return c(),p(oe,{id:"booksWindow",direction:"vertical","model-value":e.currentBookPk,reverse:e.isBTT,"show-arrows":"",onClick:o.click},{prev:i(()=>[r(n,{direction:"prev"})]),next:i(()=>[r(n,{direction:"next"})]),default:i(()=>[(c(!0),b(R,null,V(e.books,m=>(c(),p(te,{key:`c/${m.pk}`,class:"windowItem",disabled:"",eager:o.eager(m.pk),value:m.pk,transition:!0},{default:i(()=>[r(g,{book:m,onClick:o.click},null,8,["book","onClick"])]),_:2},1032,["eager","value"]))),128))]),_:1},8,["model-value","reverse","onClick"])}const ke=k(Xt,[["render",Jt],["__scopeId","data-v-b32da175"]]),Qt={a:Oe,f:Ee,s:xe},Zt={a:"Story Arc",f:"Folder",s:"Series"},eo={name:"ReaderArcSelect",computed:{...v(d,{arcGroup:e=>{var t;return((t=e.arc)==null?void 0:t.group)||"s"},arcName:e=>{for(const t of e.arcs)if(e.arc.group===t.group&&e.arc.pk===t.pk)return t.name;return"Unknown"},arcKey:e=>`${e.arc.group}:${e.arc.pk}`,arcItems:e=>{const t=[];for(const a of e.arcs){const u={value:`${a.group}:${a.pk}`,title:a.name,group:a.group};t.push(u)}return t},arcPosition:function(e){const t=e.arc;return t&&t.index&&t.count?`${t.index}/${t.count}`:""}}),arc:{get(){return this.arcKey},set(e){const t=this.$route.params;if(!t)return;const[a,u]=e.split(":"),l={...t,arcGroup:a,arcPk:u};this.loadBooks(l)}}},methods:{...f(d,["loadBooks"]),arcIcon(e){return Qt[e]},arcLabel(e){return Zt[e]},checkIcon(e){return e===this.arc?Ve:""}}},to={key:2,id:"arcPosition"};function oo(e,t,a,u,l,o){return c(),b(R,null,[e.arcItems.length>1?(c(),p(Ae,{key:0,modelValue:o.arc,"onUpdate:modelValue":t[0]||(t[0]=n=>o.arc=n),class:"arcSelect",density:"compact","hide-details":"auto",label:"Order",variant:"plain",items:e.arcItems},{item:i(({item:n,props:g})=>[r(E,W(g,{density:"compact",variant:"plain","prepend-icon":o.arcIcon(n.raw.group),subtitle:o.arcLabel(n.raw.group),"append-icon":o.checkIcon(g.value)}),null,16,["prepend-icon","subtitle","append-icon"])]),selection:i(({item:n,props:g})=>[r(E,W(g,{density:"compact",variant:"plain"}),{default:i(()=>[r(P,null,{default:i(()=>[h(_(o.arcIcon(n.raw.group)),1)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","items"])):(c(),p(P,{key:1,id:"onlyArc",title:e.arcName},{default:i(()=>[h(_(o.arcIcon(e.arcGroup)),1)]),_:1},8,["title"])),e.arcPosition?(c(),b("span",to,_(e.arcPosition),1)):y("",!0)],64)}const _e=k(eo,[["render",oo],["__scopeId","data-v-bb646eeb"]]),ao={name:"ReaderTitleToolbar",components:{MetadataDialog:re,ReaderArcSelect:_e,SettingsDrawerButton:Ne},data(){return{mdiClose:We,routeChanged:!1}},head(){return{meta:[{hid:"description",name:"description",content:`reader ${this.activeTitle} page ${this.storePage}`}]}},computed:{...w(d,["activeTitle"]),...v(d,{pk:e=>{var t,a;return((a=(t=e.books)==null?void 0:t.current)==null?void 0:a.pk)||0}}),...v(Ue,{lastRoute:e=>e.page.routes.last}),...F(B,["isSettingsDrawerOpen"]),closeBookRoute:function(){const e={name:"browser",params:this.lastRoute};return e.params?e.hash=`#card-${this.pk}`:e.params=window.CODEX.LAST_ROUTE||ze.browser.route,e}},watch:{$route(e,t){t&&(this.routeChanged=!0)}},mounted(){document.addEventListener("keyup",this._keyListener)},beforeUnmount(){document.removeEventListener("keyup",this._keyListener)},methods:{...f(B,["setTimestamp"]),...f(d,["routeToDirection","routeToDirectionOne","routeToBook","setBookChangeFlag"]),openMetadata(){this.$refs.metadataDialog.dialog=!0},onCloseBook(){this.routeChanged&&this.setTimestamp()},_keyListener(e){switch(e.stopPropagation(),e.key){case"Escape":this.$refs.closeBook.$el.click();break;case"m":this.openMetadata();break}}}},so={key:0};function no(e,t,a,u,l,o){const n=_e,g=re,m=S("SettingsDrawerButton");return c(),p(Me,{id:"readerTopToolbar",class:"codexToolbar",density:"compact"},{default:i(()=>[r(M,null,{default:i(()=>[r(z,{id:"closeBook",ref:"closeBook",to:o.closeBookRoute,size:"large",onClick:o.onCloseBook},{default:i(()=>[e.$vuetify.display.smAndDown?(c(),p(P,{key:1,title:"Close Book"},{default:i(()=>[h(_(l.mdiClose),1)]),_:1})):(c(),b("span",so,"close book"))]),_:1},8,["to","onClick"])]),_:1}),r(Fe,{id:"toolbarTitle",class:"codexToolbarTitle"},{default:i(()=>[h(_(e.activeTitle),1)]),_:1}),r(M,null,{default:i(()=>[r(n),r(z,{id:"tagButton",onClick:U(o.openMetadata,["stop"])},{default:i(()=>[r(g,{ref:"metadataDialog",group:"c",pk:e.pk},null,8,["pk"])]),_:1},8,["onClick"]),r(m,{id:"settingsButton",onClick:t[0]||(t[0]=U(D=>e.isSettingsDrawerOpen=!0,["stop"]))})]),_:1})]),_:1})}const be=k(ao,[["render",no],["__scopeId","data-v-5febc51f"]]),ro={name:"BookChangeDrawer",props:{direction:{type:String,required:!0}},head(){if(this.isDrawerOpen)return this.prefetchLinks(this.params,this.computedDirection,!0)},computed:{...w(d,["isBTT"]),...v(d,{computedDirection(){return this.normalizeDirection(this.direction)},params(e){return e.routes.books[this.computedDirection]},isDrawerOpen(e){return e.bookChange===this.computedDirection},icon(){return this.bookChangeIcon(this.computedDirection)}}),drawerLocation(){return this.bookChangeLocation(this.direction)},cursorClass(){return this.bookChangeCursorClass(this.computedDirection)},show(){return this.bookChangeShow(this.computedDirection)},route(){return this.toRoute(this.params)},label(){return this.linkLabel(this.computedDirection,"Book")}},methods:{...f(d,["getSettings","linkLabel","normalizeDirection","prefetchLinks","toRoute","bookChangeLocation","bookChangeCursorClass","bookChangeShow","bookChangeIcon"])}};function io(e,t,a,u,l,o){const n=S("router-link");return o.show?(c(),p(Ge,{key:0,class:"bookChangeDrawer","disable-resize-watcher":"","disable-route-watcher":"",location:o.drawerLocation,"model-value":e.isDrawerOpen,scrim:!1,temporary:"",touchless:""},{default:i(()=>[r(n,{class:T({navLink:!0,[o.cursorClass]:!0}),to:o.route,"aria-label":o.label,title:o.label,onClick:t[0]||(t[0]=g=>g.stopImmediatePropagation())},{default:i(()=>[r(P,{class:"bookChangeIcon"},{default:i(()=>[h(_(e.icon),1)]),_:1})]),_:1},8,["class","to","aria-label","title"])]),_:1},8,["location","model-value"])):y("",!0)}const fe=k(ro,[["render",io],["__scopeId","data-v-1c15e0d9"]]),lo={name:"DownloadPanel",data(){return{mdiDownload:He,mdiFileImage:qe}},computed:{...w(d,["activeTitle","routeParams"]),...v(d,{storePage:e=>e.page,filename:e=>{var t,a;return(a=(t=e.books)==null?void 0:t.current)==null?void 0:a.filename},downloadURL(e){return Ke(e.books.current.pk)}}),pageSrc(){return je(this.routeParams)},pageName(){return`${this.activeTitle} - page ${this.storePage}.jpg`}},methods:{...f(B,["downloadIOSPWAFix"]),downloadPage(){this.downloadIOSPWAFix(this.pageSrc,this.pageName)},downloadBook(){this.downloadIOSPWAFix(this.downloadURL,this.filename)}}},co={id:"downloadPanel"};function uo(e,t,a,u,l,o){return c(),b("div",co,[r(E,{onClick:o.downloadPage},{default:i(()=>[r(G,null,{default:i(()=>[r(P,null,{default:i(()=>[h(_(l.mdiFileImage),1)]),_:1}),h("Download Page "+_(e.storePage),1)]),_:1})]),_:1},8,["onClick"]),r(E,{onClick:o.downloadBook},{default:i(()=>[r(G,null,{default:i(()=>[r(P,null,{default:i(()=>[h(_(l.mdiDownload),1)]),_:1}),h("Download Book ")]),_:1})]),_:1},8,["onClick"])])}const ve=k(lo,[["render",uo],["__scopeId","data-v-52aba7d6"]]),Pe=["fitTo","readingDirection","twoPages"];Object.freeze(Pe);const go={name:"ReaderSettingsPanel",data(){return{isGlobalScope:!1}},computed:{...w(d,["isVertical"]),...v(d,{choices:e=>e.choices,selectedSettings(e){var t,a;return this.isGlobalScope||!((t=e.books)!=null&&t.current)?e.readerSettings:(a=e.books)==null?void 0:a.current.settings},isClearSettingsButtonDisabled(e){var t,a;if(this.isGlobalScope||!((t=e.books)!=null&&t.current))return!0;for(const u of Pe){const l=(a=e.books)==null?void 0:a.current.settings[u];if(!e.choices.nullValues.has(l))return!1}return!0}}),...F(d,["readRtlInReverse"]),fitToChoices(){return this.choicesWithoutNull("fitTo")},readingDirectionChoices(){return this.choicesWithoutNull("readingDirection")}},mounted(){document.addEventListener("keyup",this._keyListener)},beforeUnmount(){document.removeEventListener("keyup",this._keyListener)},methods:{...f(d,["clearSettingsLocal","setSettingsGlobal","setSettingsLocal"]),settingsDialogChanged(e){this.isGlobalScope?this.setSettingsGlobal(e):this.setSettingsLocal(e)},choicesWithoutNull(e){const t=[];for(const a of this.choices[e])a.value&&t.push(a);return Object.freeze(t),t},_keyListener(e){e.stopPropagation();let t;switch(e.key){case"w":t={fitTo:"W"};break;case"h":t={fitTo:"H"};break;case"s":t={fitTo:"S"};break;case"o":t={fitTo:"O"};break;case"2":t={twoPages:!this.selectedSettings.twoPages};break;case"l":t={readingDirection:"ltr"};break;case"r":t={readingDirection:"rtl"};break;case"t":t={readingDirection:"ttb"};break;case"b":t={readingDirection:"bbt"};break}t&&this.setSettingsLocal(t)}}},ho={id:"readerSettings"};function po(e,t,a,u,l,o){return c(),b("div",ho,[r(N,{modelValue:l.isGlobalScope,"onUpdate:modelValue":t[0]||(t[0]=n=>l.isGlobalScope=n),density:"compact",label:"Scope","hide-details":"auto"},{default:i(()=>[r(I,{label:"Only this comic",value:!1}),r(I,{label:"Default for all comics",value:!0})]),_:1},8,["modelValue"]),r(N,{class:"displayRadioGroup",density:"compact",label:"Display","hide-details":"auto","model-value":e.selectedSettings.fitTo,"onUpdate:modelValue":t[1]||(t[1]=n=>o.settingsDialogChanged({fitTo:n}))},{default:i(()=>[(c(!0),b(R,null,V(o.fitToChoices,n=>(c(),p(I,{key:n.value,label:n.title,value:n.value},null,8,["label","value"]))),128))]),_:1},8,["model-value"]),r(H,{disabled:e.isVertical,class:"displayTwoPages",density:"compact",label:"Two pages","hide-details":"auto","model-value":e.selectedSettings.twoPages,"true-value":!0,indeterminate:e.selectedSettings.twoPages===null||e.selectedSettings.twoPages===void 0,"onUpdate:modelValue":t[2]||(t[2]=n=>o.settingsDialogChanged({twoPages:n}))},null,8,["disabled","model-value","indeterminate"]),r(N,{class:"displayRadioGroup",density:"compact",label:"Reading Direction","hide-details":"auto","model-value":e.selectedSettings.readingDirection,"onUpdate:modelValue":t[3]||(t[3]=n=>o.settingsDialogChanged({readingDirection:n}))},{default:i(()=>[(c(!0),b(R,null,V(o.readingDirectionChoices,n=>(c(),p(I,{key:n.value,label:n.title,value:n.value},null,8,["label","value"]))),128))]),_:1},8,["model-value"]),l.isGlobalScope?(c(),p(H,{key:0,"model-value":e.selectedSettings.readRtlInReverse,class:"readRtlInReverse",density:"compact",label:"Read RTL Comics as LTR","hide-details":"auto","true-value":!0,"onUpdate:modelValue":t[4]||(t[4]=n=>o.settingsDialogChanged({readRtlInReverse:n}))},null,8,["model-value"])):y("",!0),l.isGlobalScope?y("",!0):(c(),p(z,{key:1,id:"clearSettingsButton",disabled:e.isClearSettingsButtonDisabled,title:"Use the default settings for all comics for this comic",onClick:e.clearSettingsLocal},{default:i(()=>[h(" Clear Comic Settings ")]),_:1},8,["disabled","onClick"]))])}const we=k(go,[["render",po],["__scopeId","data-v-fd9cbdd2"]]),mo={name:"KeyboardShortcutsPanel",data(){return{mdiMenuLeft:Ye,mdiMenuRight:Xe,mdiKeyboardOutline:Je,mdiKeyboardSpace:Qe,mdiAppleKeyboardShift:Ze}},computed:{...w(B,["isMobile"])}},C=e=>(st("data-v-310c86ae"),e=e(),nt(),e),ko=C(()=>s("h4",null,"Navigation",-1)),_o={class:"highlight-table"},bo=C(()=>s("td",null,"Previous page",-1)),fo=C(()=>s("td",null,"Next page",-1)),vo=C(()=>s("tr",null,[s("td",null,","),s("td",null,[h("Next "),s("em",null,"only"),h(" one page in two page mode.")])],-1)),Po=C(()=>s("tr",null,[s("td",null,"."),s("td",null,[h("Previous "),s("em",null,"only"),h(" one page in two page mode.")])],-1)),wo=C(()=>s("tr",null,[s("td",null,"p"),s("td",null,"Previous Book")],-1)),So=C(()=>s("tr",null,[s("td",null,"n"),s("td",null,"Next Book")],-1)),Co=C(()=>s("h4",null,"Fit Page To",-1)),yo=C(()=>s("table",{class:"highlight-table"},[s("tbody",null,[s("tr",null,[s("td",null,"s"),s("td",null,"screen")]),s("tr",null,[s("td",null,"h"),s("td",null,"screen height")]),s("tr",null,[s("td",null,"w"),s("td",null,"screen width")]),s("tr",null,[s("td",null,"o"),s("td",null,"Show page at original size")]),s("tr",null,[s("td",null,"2"),s("td",null,"Toggle two page view")]),s("tr",null,[s("td",null,"r"),s("td",null,"Read Right to Left")]),s("tr",null,[s("td",null,"l"),s("td",null,"Read Left to Right")]),s("tr",null,[s("td",null,"t"),s("td",null,"Read Top to Bottom")]),s("tr",null,[s("td",null,"b"),s("td",null,"Read in Bottom to Top")])])],-1)),Ro=C(()=>s("h4",null,"Other",-1)),To=C(()=>s("table",{class:"highlight-table"},[s("tbody",null,[s("tr",null,[s("td",null,"m"),s("td",null,"Show comic's metadata")]),s("tr",null,[s("td",null,"esc"),s("td",null,"Close book")])])],-1));function Bo(e,t,a,u,l,o){return e.isMobile?y("",!0):(c(),p(at,{key:0},{default:i(()=>[r(et,{id:"readerKeyboardShortcuts"},{default:i(()=>[r(tt,{id:"shortcutsTitle"},{default:i(()=>[r(P,{id:"keyboardIcon"},{default:i(()=>[h(_(l.mdiKeyboardOutline),1)]),_:1}),h("Keyboard Shortcuts ")]),_:1}),r(ot,null,{default:i(()=>[ko,s("table",_o,[s("tbody",null,[s("tr",null,[s("td",null,[r(P,{class:"keyIcon",density:"compact"},{default:i(()=>[h(_(l.mdiMenuLeft),1)]),_:1}),h(", j, "),s("div",null,[r(P,{class:"keyIcon",density:"compact"},{default:i(()=>[h(_(l.mdiAppleKeyboardShift),1)]),_:1}),r(P,{class:"keyIcon",density:"compact"},{default:i(()=>[h(_(l.mdiKeyboardSpace),1)]),_:1})])]),bo]),s("tr",null,[s("td",null,[r(P,{class:"keyIcon",density:"compact"},{default:i(()=>[h(_(l.mdiMenuRight),1)]),_:1}),h(", k, "),r(P,{class:"keyIcon",density:"compact"},{default:i(()=>[h(_(l.mdiKeyboardSpace),1)]),_:1})]),fo]),vo,Po,wo,So])]),Co,yo,Ro,To]),_:1})]),_:1})]),_:1}))}const Do=k(mo,[["render",Bo],["__scopeId","data-v-310c86ae"]]),Io={name:"ReaderSettingsSuperPanel",components:{DownloadPanel:ve,ReaderKeyboardShortcutsPanel:Do,ReaderSettingsPanel:we}};function $o(e,t,a,u,l,o){const n=we,g=S("ReaderKeyboardShortcutsPanel"),m=ve;return c(),b(R,null,[r(n),r(q),r(g),r(q),r(m)],64)}const Lo=k(Io,[["render",$o]]),Vo={name:"MainReader",components:{BookChangeDrawer:fe,BooksWindow:ke,ReaderNavToolbar:ce,ReaderTitleToolbar:be,SettingsDrawer:ae},data(){return{showToolbars:!1,ReaderSettingsSuperPanel:Z(Lo)}},computed:{...w(K,["isCodexViewable"]),...v(K,{user:e=>e.user})},watch:{user(){this.loadReaderSettings()},isCodexViewable(){this.loadReaderSettings()}},created(){B().isSettingsDrawerOpen=!1},beforeMount(){d().$reset,this.loadReaderSettings()},methods:{...f(d,["loadReaderSettings"]),toggleToolbars(){this.showToolbars=!this.showToolbars}}},Oo={key:0,id:"readerContainer"},Eo={key:1,id:"announcement"};function xo(e,t,a,u,l,o){const n=fe,g=be,m=ke,D=ce,A=S("router-link"),Se=ae;return c(),b(R,null,[r(rt,{id:"readerWrapper"},{default:i(()=>[r(n,{direction:"prev"}),e.isCodexViewable?(c(),b("div",Oo,[r(it,null,{default:i(()=>[O(r(g,null,null,512),[[j,l.showToolbars]])]),_:1}),r(m,{onClick:o.toggleToolbars},null,8,["onClick"]),r(lt,null,{default:i(()=>[O(r(D,null,null,512),[[j,l.showToolbars]])]),_:1})])):(c(),b("div",Eo,[s("h1",null,[r(A,{to:{name:"home"}},{default:i(()=>[h(" Log in ")]),_:1}),h(" to read comics ")])]))]),_:1}),r(n,{direction:"next"}),r(Se,{title:"Reader Settings",panel:l.ReaderSettingsSuperPanel,temporary:""},null,8,["panel"])],64)}const Wo=k(Vo,[["render",xo],["__scopeId","data-v-fd949081"]]);export{Wo as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/page-pdf-8DCW311Z.js","assets/admin-eKzY3vzh.js","assets/admin-I3RmFwkX.css","assets/page-pdf-Pldb5VSY.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
