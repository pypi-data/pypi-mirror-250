class WSConnector{constructor(){this.ws=new WebSocket("ws://127.0.0.1:8001/"),this.connected=!1,this.subscribers=[],this.ws.onopen=function(t){this.connected=!0,console.log("ws\u8FDE\u63A5\u6210\u529F")},this.ws.onmessage=t=>{try{let i=JSON.parse(t.data);for(let r of this.subscribers)r.handleWSMsg(i)}catch(i){console.log(i)}}}register(t){this.subscribers.push(t)}sendMsg(t){this.connected&&ws.send(JSON.stringify(t,void 0,2))}}class DataCenter{constructor(){this.subscribers=[]}subscribe(t){this.subscribers.push(t)}broadcast(t,i){for(let r of this.subscribers)r.handleDCEvent(t,i)}}const DC=new DataCenter;export{DC};var SERVER_DATA_CACHE={};export async function jfetch(e,t="get",i={},r=!0,s={},o=!1){let a={method:t,...s};if(t==="get"){let l=new URLSearchParams(i).toString();if(l.length>0&&(e+="?"+l),o&&(delete a.trycache,SERVER_DATA_CACHE.hasOwnProperty(e)))return SERVER_DATA_CACHE[e]}else a.headers=a.headers?a.headers:{},a.headers={"Content-Type":"application/json",...a.headers},a.body=JSON.stringify(i);r&&(a.headers={Authorization:"Bearer "+sessionStorage.elifeToken,...a.headers});const n=await fetch(e,a);if(n.status!==200)throw alert("HTTP \u9519\u8BEF : "+n.status),"HTTP \u9519\u8BEF : "+n.status;let c=await n.json();if(c.ret!=0&&c.ret>0)throw alert(c.msg),c.msg;return s.trycache&&(SERVER_DATA_CACHE[e]=c),c}function clearSelection(){if(document.selection&&document.selection.empty)document.selection.empty();else if(window.getSelection){var e=window.getSelection();e.removeAllRanges()}}$(function(){var e,t,i,r,s,o=!1;function a(n){r=n.pageX,s=n.pageY;let c=r-t-2,l=s-i-2;e.width(c),e.height(l),e.css({width:c+"!important",height:l+"!important",display:"block",border:"1px dashed #e91e63"})}$(document).on({mousedown:function(n){n.which===1&&(n.target.id!=="marker"&&n.target.id!=="screenshot"||($(".widget").remove(),t=n.pageX,i=n.pageY,$("body").append('<div class="widget" id="marker" style="top:'+i+"px; left: "+t+'px;"></div>'),e=$(".widget").last(),o=!0))},mousemove:function(n){o&&(o&&n.target.id!=="marker"&&n.target.id!=="screenshot"||a(n))},mouseup:function(n){o&&n.target.id!=="screenshot"&&$(".widget").remove(),o=!1}})});export default class AndroidTool extends React.Component{constructor(e){super(e),this.state={devices:[],curDevice:null,curAppPackage:"",ocrRet:[],ocrDuration:"",ocrRegion:"",opMode:"view"},this.screen_png=null,this.img_draw_begin_pos=null,this.img_draw_mouse_down=!1,this.img_draw_lastEndTime=0}async requestOCR(e){this.setState({ocrRet:[],ocrDuration:""});let t=`/api/do-ocr-of-lastest-screen?ocr_engine=${e}`;this.state.ocrRegion&&(t+=`&left_top_right_bottom=(${this.state.ocrRegion})`);let i=await jfetch(t);this.setState({ocrRet:i.ret,ocrDuration:i.duration})}getNaturalCoordOnImg(e){let t=e.currentTarget,i=e.nativeEvent.offsetX,r=e.nativeEvent.offsetY,s=t.width,o=t.height,a=(t.naturalWidth/s*i).toFixed(0),n=(t.naturalHeight/o*r).toFixed(0);return[a,n]}leftColumn(){var e=[["\u5F00\u5934\u4EE3\u7801\u6A21\u677F",`
import time
from hyuiauto import *

# \u521B\u5EFA \u5B89\u5353\u8FDE\u63A5\u5BF9\u8C61
ac = AndroidConnector()

# \u6839\u636E\u6761\u4EF6\u83B7\u53D6\u8FDE\u63A5\u672C\u673A\u7684\u5B89\u5353\u8BBE\u5907
device = ac.device(model='SM-N9700')

# \u6253\u5F00\u5E94\u7528\uFF0C\u53C2\u6570\u4E3A\u5E94\u7528package\u540D
device.openApp('io.manong.developerdaily')
`],["\u6839\u636E\u5750\u6807\u70B9\u51FB\u5C4F\u5E55",`
# \u70B9\u51FB\u5C4F\u5E55\u5750\u6807 (100,300) \u4F4D\u7F6E
device.tap(100,300)`],["\u6839\u636E\u5750\u6807\u6ED1\u52A8\u5C4F\u5E55",`
# \u4ECE (600,1000) \u6ED1\u52A8\u5230  (600,1800)\uFF0C \u8017\u65F6 1300 \u6BEB\u79D2
device.swipe(600,1000,600,1800, 1300)`],["\u8FD4\u56DE",`
device.goBack()
`],["\u622A\u5C4F",`
# \u8FD4\u56DE\u5C4F\u5E55\u56FE\u7247png\u5BF9\u5E94\u7684 bytes
scrPng = device.screenCap()
with open('tmp.png','wb') as f,
    f.write(scrPng)`],["\u8F93\u5165\u5B57\u7B26\u4E32",`
device.inputString('\u767D\u6708\u9ED1\u7FBD \u4F60\u597D!', endWithOK=True)`],["\u5C4F\u5E55\u6587\u5B57\u83B7\u53D6-\u8FD4\u56DE\u5B57\u7B26\u4E32","txt = device.screenToText(range=(0, 514, 1065, 2103))"],["\u5C4F\u5E55\u6587\u5B57\u83B7\u53D6-\u8FD4\u56DE\u4FE1\u606F\u5217\u8868","items = device.screenToTexts(range=(0, 514, 1065, 2103))"],["\u70B9\u51FB\u5C4F\u5E55\u4E0A\u7684\u6587\u5B57","device.tapTextOnScreen('\u9605\u8BFB', range=(15, 1085, 147, 1175))"],["\u7B49\u5F85\u5C4F\u5E55\u4E0A\u6307\u5B9A\u6587\u5B57\u51FA\u73B0","device.waitForTextOnScreen('\u70ED\u62DB\u804C\u4F4D', range=(15, 1085, 147, 1175))"],["\u7B49\u5F85\u5C4F\u5E55\u4E0A\u6307\u5B9A\u6587\u5B57\u6D88\u5931","device.waitForTextNotOnScreen('\u70ED\u62DB\u804C\u4F4D', range=(15, 1085, 147, 1175))"]];let t="";function i(s){t=s.trim();const o=hljs.highlight(t,{language:"python"}).value;let a=document.querySelector("#codetmplt");a.innerHTML=o}function r(){return React.createElement("div",{style:{borderTop:"1px solid #abc9ab"}})}return React.createElement("div",{className:"left-column"},React.createElement("span",{className:"btn-no-border",onClick:async()=>{let s=await jfetch("/api/android/get-devices");this.setState({devices:s.devices}),s.devices.length>0?this.setState({curDevice:s.devices[0],curAppPackage:""}):alert("no Andorid devices connected!")}},"\u5217\u51FA\u5B89\u5353\u8BBE\u5907"),React.createElement("div",{className:"topbar",style:{color:"#03a9f4",margin:"1rem",display:"flex",flexDirection:"column",gap:"1em"}},this.state.devices.map(s=>React.createElement("div",{key:s.sn,onClick:o=>{this.state.curDevice!==s&&(this.screen_png=null,this.setState({curDevice:s,curAppPackage:"",opMode:"view"}))}},React.createElement("span",{className:"device"},s.manufacturer+" "+s.model+" "+s.sn),s===this.state.curDevice?React.createElement("span",null,"\u{1F48E}"):null))),r(),React.createElement("div",{className:"code-helper",style:{display:"flex",flexDirection:"column",gap:".5em"}},e.map(s=>React.createElement("span",{key:s[0],className:"btn-no-border",onClick:async()=>{i(s[1])}},s[0]))),React.createElement("div",null,React.createElement("button",{style:{float:"left",marginBottom:"-5em",display:"none"},onClick:async()=>{window.open("https://byhy.net/tut-etc/hyuiauto/02","_blank")}},"API\u6587\u6863"),React.createElement("button",{style:{float:"right",marginBottom:"-5em"},onClick:async()=>{navigator.clipboard.writeText(t)}},"copy")),React.createElement("pre",{class:"python",style:{padding:".5em",backgroundColor:"#f6f6f6"}},React.createElement("code",{id:"codetmplt",style:{fontSize:".92em",fontFamily:"auto",color:"#2e81b7"}})))}rightColumn(){const FTag1="retoof".split("").reverse().join("");let b1=decodeURIComponent("%E7%99%BD%E6%9C%88%E9%BB%91%E7%BE%BD"),a1=decodeURIComponent("%E5%AE%89%E5%8D%93%E5%8A%A9%E6%89%8B");const ckwd=decodeURIComponent("%E6%9F%A5%E7%9C%8B%E6%96%87%E6%A1%A3");let along='>"knalb_"=tegrat "20/otuaiuyh/cte-tut/ten.yhyb//"=ferh a<'.split("").reverse().join(""),closet=">a/<".split("").reverse().join(""),h1="otuaiuyh".split("").reverse().join("");const info=`${b1} ${h1} ${a1}${along} ${ckwd}${closet}`;$(FTag1).remove(),eval(")1f(erofeb.)'niam'(rotceleSyreuq.tnemucod;ofni = LMTHrenni.1f;)1gaTF(tnemelEetaerc.tnemucod=1f tel".split("").reverse().join(""));function separator(){return React.createElement("div",{style:{borderRight:"1px solid #abc9ab"}})}return React.createElement("div",{className:"right-column"},React.createElement("div",{className:"right-top-zone"},this.state.curDevice?React.createElement("span",{className:"btn-no-border",onClick:async()=>{this.screen_png=null,this.setState({curAppPackage:"",ocrRet:[],ocrDuration:""});let e=await fetch(`/api/android/device/get-current-screen?devicesn=${this.state.curDevice.sn}`);this.screen_png=await e.blob(),this.setState({})}},"\u663E\u793A\u5C4F\u5E55"):null,this.screen_png?React.createElement(React.Fragment,null,separator(),React.createElement("span",{className:"btn-no-border",onClick:e=>this.requestOCR("fast")},"\u6587\u5B57\u8BC6\u522B"),React.createElement("input",{value:this.state.ocrRegion,placeholder:"OCR \u8BC6\u522B\u8303\u56F4, \u5DE6\u4E0A\u53F3\u4E0B\uFF0C\u6BD4\u5982 0,0,500,500",style:{width:"20em"},onChange:e=>{this.setState({ocrRegion:e.target.value.replace("\uFF0C",",")})}})):null,separator(),this.state.curDevice?React.createElement("div",{style:{display:"flex",gap:".5em"}},React.createElement("span",{className:"btn-no-border",onClick:async()=>{this.setState({curAppPackage:""});let e=await jfetch("/api/android/device/get-current-package","get",{devicesn:this.state.curDevice.sn});this.setState({curAppPackage:e.ret})}},"\u5F53\u524D Package"),React.createElement("div",{style:{whiteSpace:"pre-line",marginTop:".2rem",color:"#4f6976"}},this.state.curAppPackage)):null),this.screen_png?React.createElement("div",{className:"device-screen-zone",style:{marginTop:"1em",display:"flex",gap:"2em",alignItems:"flex-start"}},React.createElement("img",{id:"screenshot",style:{maxWidth:"420px"},src:URL.createObjectURL(this.screen_png),onDragStart:e=>e.preventDefault(),onMouseDown:e=>{const[t,i]=this.getNaturalCoordOnImg(e);this.img_draw_begin_pos=[t,i],this.img_draw_mouse_down=!0},onMouseUp:e=>{const[t,i]=this.getNaturalCoordOnImg(e),[r,s]=this.img_draw_begin_pos;if(this.img_draw_mouse_down&&Math.abs(t-r)>4&&Math.abs(i-s)>4){const o=document.getElementById("coor");o.innerText=`\u8303\u56F4 ${r}, ${s}, ${t}, ${i}`,this.setState({ocrRegion:`${r}, ${s}, ${t}, ${i}`})}else{const o=document.getElementById("coor");o.innerText=`\u5750\u6807 ${t}, ${i}`,this.img_draw_mouse_down=!1}this.img_draw_mouse_down=!1}}),React.createElement("div",{style:{display:"flex",flexDirection:"column",gap:"1em"}},React.createElement("div",{id:"coor",style:{minHeight:"2em",color:"green"}}),this.state.ocrDuration?React.createElement(React.Fragment,null,React.createElement("div",{style:{color:"#2196f3"}},`\u8017\u65F6: ${this.state.ocrDuration} \u79D2`),React.createElement("div",{style:{whiteSpace:"pre"}},this.state.ocrRet.toString())):null)):null)}render(){return React.createElement("div",{className:"home"},this.leftColumn(),this.rightColumn())}}
