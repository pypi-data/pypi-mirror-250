import{d as $,r as f,o as I,a as p,b as r,c as d,e as a,f as l,w as O,g as y,h as U,t as k,i as R,F as E,j as C,_ as H,k as j,l as V,n as L,H as q}from"./index-HE3Hb442.js";import{h as T}from"./axios-E9t6lfA1.js";const B={style:{padding:"10px 10px"}},F={key:0},z={key:1},P=$({__name:"ContactsList",props:["tableData"],emits:["userData"],setup(e,{emit:u}){const t=f([]),c=async(_,w,D="")=>{try{return await T.post("/api/contact_count_list",{start:_,limit:w,word:D})}catch(b){return console.error("Error fetching data:",b),[]}};I(async()=>{try{const _=await c(0,800);t.value=_}catch(_){return console.error("Error fetching data:",_),[]}});const s=f(""),h=async()=>{try{const _=await c(0,100,s.value);t.value=_}catch(_){return console.error("Error fetching data:",_),[]}},g=u,x=_=>{_!==void 0&&g("userData",_)};return(_,w)=>{const D=p("el-input"),b=p("el-button"),M=p("el-table-column"),i=p("el-table");return r(),d("div",null,[a("div",B,[l(D,{placeholder:"请输入关键字",modelValue:s.value,"onUpdate:modelValue":w[0]||(w[0]=v=>s.value=v),onKeyup:O(h,["enter"]),style:{width:"160px"}},null,8,["modelValue"]),l(b,{type:"primary",onClick:h,style:{width:"70px"}},{default:y(()=>[U("搜索")]),_:1})]),l(i,{data:t.value,stripe:"",style:{width:"100%"},"max-height":"100%",height:"100%","highlight-current-row":"",onCurrentChange:x},{default:y(()=>[l(M,{label:"name",width:"180"},{default:y(({row:v})=>[v.remark!==null&&v.remark!==""?(r(),d("span",F,k(v.remark),1)):(r(),d("span",z,k(v.nickname),1))]),_:1}),l(M,{prop:"chat_count",label:"num",width:"70"})]),_:1},8,["data"])])}}}),A=$({__name:"ChatRecprdsHeader",props:{userData:{type:Object,required:!0}},setup(e){const u=[{wxid:"username",账号:"account",昵称:"nickname"},{备注:"remark",描述:"describe",数量:"chat_count"}];return(t,c)=>{const o=p("el-text"),s=p("el-col"),h=p("el-row");return r(),d(E,null,R(u,(g,x)=>l(h,{gutter:5,style:{width:"100%"},key:x},{default:y(()=>[(r(!0),d(E,null,R(g,(_,w)=>(r(),C(s,{key:w,span:8,style:{"white-space":"nowrap"}},{default:y(()=>[l(o,{class:"label_color mx-1",truncated:""},{default:y(()=>[U(k(w)+":",1)]),_:2},1024),U("  "),l(o,{class:"data_color mx-1",truncated:"",title:e.userData[_]},{default:y(()=>[U(k(e.userData[_]),1)]),_:2},1032,["title"])]),_:2},1024))),128))]),_:2},1024)),64)}}}),K=H(A,[["__scopeId","data-v-cb8b8fa3"]]),W={class:"chat-content"},G={key:0,class:"word"},J=["src"],Q={class:"info"},X={class:"time"},Y=["innerHTML"],Z={key:1,class:"word-my"},ee={class:"info"},te={class:"time"},ae=["innerHTML"],ne=["src"],se=$({__name:"MessageText",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""}},setup(e){const u=t=>(t=t.replace(/\n/g,"<br>"),new DOMParser().parseFromString(t,"text/html").body.innerHTML);return(t,c)=>(r(),d("div",W,[e.is_sender?(r(),d("div",Z,[a("div",ee,[a("p",te,k(e.direction),1),a("div",{class:"info-content",innerHTML:u(e.content)},null,8,ae)]),a("img",{src:e.headUrl},null,8,ne)])):(r(),d("div",G,[a("img",{src:e.headUrl},null,8,J),a("div",Q,[a("p",X,k(e.direction),1),a("div",{class:"info-content",innerHTML:u(e.content)},null,8,Y)])]))]))}}),re=H(se,[["__scopeId","data-v-d930be9e"]]),oe={class:"chat-content"},ce={key:0,class:"word"},le=["src"],ie={class:"info"},de={class:"time"},ue={class:"demo-image__preview"},_e={key:1,class:"word-my"},he={class:"info"},me={class:"time"},pe={class:"demo-image__preview"},ve=["src"],ye=$({__name:"MessageImg",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(e){const u=e,t=f("");I(async()=>{t.value=await c(u.src)});const c=async o=>{try{return await T.post("/api/img",{img_path:o})}catch(s){return console.error("Error fetching data:",s),""}};return(o,s)=>{const h=p("el-image");return r(),d("div",oe,[e.is_sender?(r(),d("div",_e,[a("div",he,[a("p",me,k(e.direction),1),a("div",pe,[l(h,{style:{"max-width":"150px","max-height":"150px"},src:t.value,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[t.value],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])]),a("img",{src:e.headUrl},null,8,ve)])):(r(),d("div",ce,[a("img",{src:e.headUrl},null,8,le),a("div",ie,[a("p",de,k(e.direction),1),a("div",ue,[l(h,{style:{"max-width":"150px","max-height":"150px"},src:t.value,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[t.value],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])])]))])}}}),fe=H(ye,[["__scopeId","data-v-2190d708"]]),we={class:"chat-content"},ge={key:0,class:"word"},ke=["src"],xe={class:"info"},be={class:"time"},$e={controls:"",style:{"background-color":"#fff"}},De=["src"],Se={key:1,class:"word-my"},Me={class:"info"},Ue={class:"time"},Ce={controls:"",style:{"background-color":"#95EC69"}},Te=["src"],He=["src"],Ie=$({__name:"MessageAudio",props:{is_sender:{type:Number,default:0},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""},msg:{type:String,default:""}},setup(e){const u=e,t=f("");I(async()=>{t.value=await c(u.src)});const c=async o=>{try{return await T.post("/api/audio",{MsgSvrID:o})}catch(s){return console.error("Error fetching data:",s),""}};return(o,s)=>{const h=p("el-textarea");return r(),d("div",we,[e.is_sender?(r(),d("div",Se,[a("div",Me,[a("p",Ue,k(e.direction),1),a("audio",Ce,[a("source",{src:t.value,type:"audio/wav"},null,8,Te)]),l(h,{rows:1,readonly:!0,value:e.msg,style:{width:"100%"}},null,8,["value"])]),a("img",{src:e.headUrl},null,8,He)])):(r(),d("div",ge,[a("img",{src:e.headUrl},null,8,ke),a("div",xe,[a("p",be,k(e.direction),1),a("audio",$e,[a("source",{src:t.value,type:"audio/wav"},null,8,De)]),l(h,{rows:1,readonly:!0,value:e.msg,style:{width:"100%"}},null,8,["value"])])]))])}}}),Re=H(Ie,[["__scopeId","data-v-ea5c011c"]]),Ee={id:"chat"},Ve={class:"chat_body"},Le={class:"chat_window",ref:"chatWindow"},Ne={key:0,class:"load_more",style:{display:"flex","justify-content":"center","margin-top":"10px","margin-bottom":"10px"}},Oe=$({__name:"ChatRecordsMain",props:{userData:{type:Object,required:!0},setScrollTop:{type:Function,required:!0}},setup(e,{expose:u}){const t=e,c=f([]),o=f({}),s=f(""),h=f(200),g=f(0),x=f(!1),_=async(i,v,m)=>{try{const n=await T.post("/api/msgs",{start:i,limit:v,wxid:m});return c.value=n.msg_list,o.value=n.user_list,s.value=n.my_wxid,n}catch(n){return console.error("Error fetching data:",n),[]}},w=async()=>{try{g.value=t.userData.chat_count-h.value,await _(g.value,h.value,t.userData.username),x.value||await L(()=>{t.setScrollTop(),x.value=!1})}catch(i){return console.error("Error fetching data:",i),[]}};I(w),j(()=>t.userData.username,(i,v)=>{c.value=[],x.value=!1,w()});const D=i=>(i.talker=="我"&&(i.talker=s.value),`${(m=>o.value.hasOwnProperty(m.talker)?o.value[m.talker].remark?o.value[m.talker].remark:o.value[m.talker].nickname?o.value[m.talker].nickname:o.value[m.talker].account?o.value[m.talker].account:m.talker:m.talker)(i)} [${i.type_name}] ${i.CreateTime}`),b=i=>(i.talker=="我"&&(i.talker=s.value),o.value.hasOwnProperty(i.talker)?o.value[i.talker].headImgUrl:""),M=async()=>{let i=h.value,v=g.value-i;const m=await T.post("/api/msgs",{start:v,limit:i,wxid:t.userData.username});g.value=v,c.value=m.msg_list.concat(c.value),c.value.sort((n,S)=>n.id-S.id),c.value=c.value.filter((n,S,N)=>S===0||n.id!==N[S-1].id),o.value=Object.assign(o.value,m.user_list)};return u({loadMore:M}),(i,v)=>{const m=p("el-button");return r(),d("div",Ee,[a("div",Ve,[a("div",Le,[c.value.length<e.userData.chat_count?(r(),d("div",Ne,[l(m,{type:"primary",onClick:M},{default:y(()=>[U("查看更多消息")]),_:1})])):V("",!0),(r(!0),d(E,null,R(c.value,(n,S)=>(r(),d("div",{class:"message",key:S},[n.type_name=="文本"?(r(),C(re,{key:0,is_sender:n.is_sender,direction:D(n),headUrl:b(n),content:n.content.msg},null,8,["is_sender","direction","headUrl","content"])):n.type_name=="图片"?(r(),C(fe,{key:1,is_sender:n.is_sender,direction:D(n),headUrl:b(n),src:n.content.src},null,8,["is_sender","direction","headUrl","src"])):n.type_name=="语音"?(r(),C(Re,{key:2,is_sender:n.is_sender,direction:D(n),headUrl:b(n),src:n.MsgSvrID,msg:n.content.msg},null,8,["is_sender","direction","headUrl","src","msg"])):V("",!0)]))),128))],512)])])}}}),je=H(Oe,[["__scopeId","data-v-92648885"]]),qe=$({__name:"ChatRecords",props:{userData:{type:Object,required:!0}},setup(e){const u=f(null),t=f(null),c=()=>{L(()=>{if(u.value){const s=u.value.$el.children[0];s&&(s.scrollTop=s.scrollHeight)}})};function o({scrollTop:s}){s===0&&t.value&&t.value.loadMore()}return(s,h)=>{const g=p("el-header"),x=p("el-scrollbar"),_=p("el-main"),w=p("el-container");return r(),C(w,null,{default:y(()=>[l(g,{style:{height:"65px","max-height":"65px",width:"100%","background-color":"#d2d2fa","padding-top":"5px"}},{default:y(()=>[l(K,{userData:e.userData},null,8,["userData"])]),_:1}),l(_,{style:{"overflow-y":"auto",height:"calc(100vh - 65px)"}},{default:y(()=>[l(x,{ref_key:"scrollbarRef",ref:u,onScroll:o},{default:y(()=>[l(je,{ref_key:"chatRecordsMainRef",ref:t,userData:e.userData,setScrollTop:c},null,8,["userData"])]),_:1},512)]),_:1})]),_:1})}}}),Be={id:"chat_view",class:"common-layout"},Fe={key:0,style:{height:"calc(100vh)",width:"100%"}},ze={key:1,style:{width:"100%",height:"100%"}},Ke=$({__name:"ChatView",setup(e){const u=f({account:"",describe:"",headImgUrl:"",nickname:"",remark:"",username:"",chat_count:0}),t=c=>{u.value=c};return(c,o)=>{const s=p("el-aside"),h=p("el-container");return r(),d("div",Be,[l(h,null,{default:y(()=>[l(s,{width:"266px",style:{"overflow-y":"auto",height:"calc(100vh)"}},{default:y(()=>[l(P,{onUserData:t})]),_:1}),u.value.username!=""?(r(),d("div",Fe,[l(qe,{userData:u.value},null,8,["userData"])])):(r(),d("div",ze,[l(q)]))]),_:1})])}}});export{Ke as default};
