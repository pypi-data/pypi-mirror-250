import{d as D,r as y,o as I,a as v,b as r,c as h,e as a,f as c,w as N,g,h as M,t as b,i as R,F as E,j as U,_ as H,k as O,l as L,n as V,H as j}from"./index-iA7fszPy.js";import{h as C}from"./axios-E9t6lfA1.js";const B={style:{padding:"10px 10px"}},F={key:0},z={key:1},P=D({__name:"ContactsList",props:["tableData"],emits:["userData"],setup(e,{emit:d}){const t=y([]),n=async(i,w,$="")=>{try{return await C.post("/api/contact_count_list",{start:i,limit:w,word:$})}catch(x){return console.error("Error fetching data:",x),[]}};I(async()=>{try{const i=await n(0,800);t.value=i}catch(i){return console.error("Error fetching data:",i),[]}});const u=y(""),m=async()=>{try{const i=await n(0,100,u.value);t.value=i}catch(i){return console.error("Error fetching data:",i),[]}},l=d,k=i=>{i!==void 0&&l("userData",i)};return(i,w)=>{const $=v("el-input"),x=v("el-button"),T=v("el-table-column"),_=v("el-table");return r(),h("div",null,[a("div",B,[c($,{placeholder:"请输入关键字",modelValue:u.value,"onUpdate:modelValue":w[0]||(w[0]=f=>u.value=f),onKeyup:N(m,["enter"]),style:{width:"160px"}},null,8,["modelValue"]),c(x,{type:"primary",onClick:m,style:{width:"70px"}},{default:g(()=>[M("搜索")]),_:1})]),c(_,{data:t.value,stripe:"",style:{width:"100%"},"max-height":"100%",height:"100%","highlight-current-row":"",onCurrentChange:k},{default:g(()=>[c(T,{label:"name",width:"180"},{default:g(({row:f})=>[f.remark!==null&&f.remark!==""?(r(),h("span",F,b(f.remark),1)):(r(),h("span",z,b(f.nickname),1))]),_:1}),c(T,{prop:"chat_count",label:"num",width:"70"})]),_:1},8,["data"])])}}}),A=D({__name:"ChatRecprdsHeader",props:{userData:{type:Object,required:!0}},setup(e){const d=[{wxid:"username",账号:"account",昵称:"nickname"},{备注:"remark",描述:"describe",数量:"chat_count"}];return(t,n)=>{const o=v("el-text"),u=v("el-col"),m=v("el-row");return r(),h(E,null,R(d,(l,k)=>c(m,{gutter:5,style:{width:"100%"},key:k},{default:g(()=>[(r(!0),h(E,null,R(l,(i,w)=>(r(),U(u,{key:w,span:8,style:{"white-space":"nowrap"}},{default:g(()=>[c(o,{class:"label_color mx-1",truncated:""},{default:g(()=>[M(b(w)+":",1)]),_:2},1024),M("  "),c(o,{class:"data_color mx-1",truncated:"",title:e.userData[i]},{default:g(()=>[M(b(e.userData[i]),1)]),_:2},1032,["title"])]),_:2},1024))),128))]),_:2},1024)),64)}}}),K=H(A,[["__scopeId","data-v-cb8b8fa3"]]),W={class:"chat-content"},G={key:0,class:"word"},J=["src"],Q={class:"info"},X={class:"time"},Y=["innerHTML"],Z={key:1,class:"word-my"},ee={class:"info"},te={class:"time"},ae=["innerHTML"],se=["src"],ne=D({__name:"MessageText",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""}},setup(e){const d=t=>(t=t.replace(/\n/g,"<br>"),new DOMParser().parseFromString(t,"text/html").body.innerHTML);return(t,n)=>(r(),h("div",W,[e.is_sender?(r(),h("div",Z,[a("div",ee,[a("p",te,b(e.direction),1),a("div",{class:"info-content",innerHTML:d(e.content)},null,8,ae)]),a("img",{src:e.headUrl},null,8,se)])):(r(),h("div",G,[a("img",{src:e.headUrl},null,8,J),a("div",Q,[a("p",X,b(e.direction),1),a("div",{class:"info-content",innerHTML:d(e.content)},null,8,Y)])]))]))}}),re=H(ne,[["__scopeId","data-v-d930be9e"]]),oe={class:"chat-content"},ce={key:0,class:"word"},le=["src"],ie={class:"info"},de={class:"time"},ue={class:"demo-image__preview"},_e={key:1,class:"word-my"},he={class:"info"},me={class:"time"},pe={class:"demo-image__preview"},ve=["src"],ye=D({__name:"MessageImg",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(e){const d=e,t=y("");I(async()=>{t.value=await n(d.src)});const n=async o=>{try{return await C.post("/api/img",{img_path:o})}catch(u){return console.error("Error fetching data:",u),""}};return(o,u)=>{const m=v("el-image");return r(),h("div",oe,[e.is_sender?(r(),h("div",_e,[a("div",he,[a("p",me,b(e.direction),1),a("div",pe,[c(m,{style:{"max-width":"150px","max-height":"150px"},src:t.value,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[t.value],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])]),a("img",{src:e.headUrl},null,8,ve)])):(r(),h("div",ce,[a("img",{src:e.headUrl},null,8,le),a("div",ie,[a("p",de,b(e.direction),1),a("div",ue,[c(m,{style:{"max-width":"150px","max-height":"150px"},src:t.value,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[t.value],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])])]))])}}}),fe=H(ye,[["__scopeId","data-v-2190d708"]]),ge={class:"chat-content"},we={key:0,class:"word"},ke=["src"],xe={class:"info"},be={class:"time"},$e={controls:"",style:{"background-color":"#fff"}},De=["src"],Se={key:1,class:"word-my"},Te={class:"info"},Me={class:"time"},Ue={controls:"",style:{"background-color":"#95EC69"}},Ce=["src"],He=["src"],Ie=D({__name:"MessageAudio",props:{is_sender:{type:Number,default:0},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""},msg:{type:String,default:""}},setup(e){const d=e,t=y("");I(async()=>{t.value=await n(d.src)});const n=async o=>{try{return await C.post("/api/audio",{MsgSvrID:o})}catch(u){return console.error("Error fetching data:",u),""}};return(o,u)=>{const m=v("el-textarea");return r(),h("div",ge,[e.is_sender?(r(),h("div",Se,[a("div",Te,[a("p",Me,b(e.direction),1),a("audio",Ue,[a("source",{src:t.value,type:"audio/wav"},null,8,Ce)]),c(m,{rows:1,readonly:!0,value:e.msg,style:{width:"100%"}},null,8,["value"])]),a("img",{src:e.headUrl},null,8,He)])):(r(),h("div",we,[a("img",{src:e.headUrl},null,8,ke),a("div",xe,[a("p",be,b(e.direction),1),a("audio",$e,[a("source",{src:t.value,type:"audio/wav"},null,8,De)]),c(m,{rows:1,readonly:!0,value:e.msg,style:{width:"100%"}},null,8,["value"])])]))])}}}),Re=H(Ie,[["__scopeId","data-v-ea5c011c"]]),Ee={id:"chat"},Ve={class:"chat_body"},Le={class:"chat_window",ref:"chatWindow"},qe={key:0,class:"load_more",style:{display:"flex","justify-content":"center","margin-top":"10px","margin-bottom":"10px"}},Ne=D({__name:"ChatRecordsMain",props:{userData:{type:Object,required:!0},setScrollTop:{type:Function,required:!0},updateScrollTop:{type:Function,required:!0}},setup(e,{expose:d}){const t=e,n=y([]),o=y({}),u=y(""),m=y(200),l=y(0),k=y(!1),i=async(_,f,p)=>{try{const s=await C.post("/api/msgs",{start:_,limit:f,wxid:p});return n.value=s.msg_list,o.value=s.user_list,u.value=s.my_wxid,s}catch(s){return console.error("Error fetching data:",s),[]}},w=async()=>{try{l.value=t.userData.chat_count-m.value,await i(l.value,m.value,t.userData.username),k.value||await V(()=>{t.setScrollTop(),k.value=!1})}catch(_){return console.error("Error fetching data:",_),[]}};I(w),O(()=>t.userData.username,(_,f)=>{n.value=[],k.value=!1,w()});const $=_=>(_.talker=="我"&&(_.talker=u.value),`${(p=>o.value.hasOwnProperty(p.talker)?o.value[p.talker].remark?o.value[p.talker].remark:o.value[p.talker].nickname?o.value[p.talker].nickname:o.value[p.talker].account?o.value[p.talker].account:p.talker:p.talker)(_)} [${_.type_name}] ${_.CreateTime}`),x=_=>(_.talker=="我"&&(_.talker=u.value),o.value.hasOwnProperty(_.talker)?o.value[_.talker].headImgUrl:""),T=async()=>{let _=m.value,f=l.value-_;const p=await C.post("/api/msgs",{start:f,limit:_,wxid:t.userData.username});l.value=f,n.value=p.msg_list.concat(n.value),n.value.sort((s,S)=>s.id-S.id),n.value=n.value.filter((s,S,q)=>S===0||s.id!==q[S-1].id),o.value=Object.assign(o.value,p.user_list),await V(()=>{t.updateScrollTop()})};return d({loadMore:T}),(_,f)=>{const p=v("el-button");return r(),h("div",Ee,[a("div",Ve,[a("div",Le,[n.value.length<e.userData.chat_count?(r(),h("div",qe,[c(p,{type:"primary",onClick:T},{default:g(()=>[M("查看更多消息")]),_:1})])):L("",!0),(r(!0),h(E,null,R(n.value,(s,S)=>(r(),h("div",{class:"message",key:S},[s.type_name=="文本"?(r(),U(re,{key:0,is_sender:s.is_sender,direction:$(s),headUrl:x(s),content:s.content.msg},null,8,["is_sender","direction","headUrl","content"])):s.type_name=="图片"?(r(),U(fe,{key:1,is_sender:s.is_sender,direction:$(s),headUrl:x(s),src:s.content.src},null,8,["is_sender","direction","headUrl","src"])):s.type_name=="语音"?(r(),U(Re,{key:2,is_sender:s.is_sender,direction:$(s),headUrl:x(s),src:s.MsgSvrID,msg:s.content.msg},null,8,["is_sender","direction","headUrl","src","msg"])):L("",!0)]))),128))],512)])])}}}),Oe=H(Ne,[["__scopeId","data-v-34f5ff8c"]]),je=D({__name:"ChatRecords",props:{userData:{type:Object,required:!0}},setup(e){const d=y(null),t=y(null);y(0);const n=y(0),o=()=>{V(()=>{if(d.value){const l=d.value.$el.children[0];l&&(l.scrollTop=l.scrollHeight,n.value=l.scrollHeight)}})},u=()=>{const l=d.value.$el.children[0];if(l){const k=n.value,i=l.scrollHeight-k;l.scrollTop=l.scrollTop+i,n.value=l.scrollHeight}};function m({scrollTop:l}){l===0&&t.value&&t.value.loadMore()}return(l,k)=>{const i=v("el-header"),w=v("el-scrollbar"),$=v("el-main"),x=v("el-container");return r(),U(x,null,{default:g(()=>[c(i,{style:{height:"65px","max-height":"65px",width:"100%","background-color":"#d2d2fa","padding-top":"5px"}},{default:g(()=>[c(K,{userData:e.userData},null,8,["userData"])]),_:1}),c($,{style:{"overflow-y":"auto",height:"calc(100vh - 65px)",padding:"0"}},{default:g(()=>[c(w,{ref_key:"scrollbarRef",ref:d,onScroll:m},{default:g(()=>[c(Oe,{ref_key:"chatRecordsMainRef",ref:t,userData:e.userData,setScrollTop:o,updateScrollTop:u},null,8,["userData"])]),_:1},512)]),_:1})]),_:1})}}}),Be={id:"chat_view",class:"common-layout"},Fe={key:0,style:{height:"calc(100vh)",width:"100%"}},ze={key:1,style:{width:"100%",height:"100%"}},Ke=D({__name:"ChatView",setup(e){const d=y({account:"",describe:"",headImgUrl:"",nickname:"",remark:"",username:"",chat_count:0}),t=n=>{d.value=n};return(n,o)=>{const u=v("el-aside"),m=v("el-container");return r(),h("div",Be,[c(m,null,{default:g(()=>[c(u,{width:"266px",style:{"overflow-y":"auto",height:"calc(100vh)"}},{default:g(()=>[c(P,{onUserData:t})]),_:1}),d.value.username!=""?(r(),h("div",Fe,[c(je,{userData:d.value},null,8,["userData"])])):(r(),h("div",ze,[c(j)]))]),_:1})])}}});export{Ke as default};
