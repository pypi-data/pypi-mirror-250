data_24h: &data_24h
  process:
    send:
      - [state]
      - [time, 86400]

data_30m: &data_30m
  process:
    send:
      - [state]
      - [time, 1800]

data_20s: &data_20s
  process:
    send:
      - [state]
      - [time, 20]

sources:
  coils:
    type: poll
    poll_interval: 5
    handle: coils
    blocks: 
      - [1, 17]
      - [21, 25]

  holding:
    type: poll
    poll_interval: 5
    handle: holding
    blocks:
      - [1, 25]
      - [101, 125]
      - [401, 425]
      - [501, 525]
      - [601, 625]
      - [701, 725]
      - [801, 813]
      - [901, 913]
      - [1001, 1073]

parameters:
  # System Alarms and Warnings
  system-ok:
    source: coils
    form:
      type: ParamBool
      address: 1
      idx: system-ok
    triggers: *data_30m
  system-warn:
    source: coils
    form:
      type: ParamBool
      address: 2
      idx: system-warn
    triggers: *data_30m
  system-alarm:
    source: coils
    form:
      type: ParamBool
      address: 3
      idx: system-alarm
    triggers: *data_30m
  system-fault:
    source: coils
    form:
      type: ParamBool
      address: 4
      idx: system-fault
    triggers: *data_30m
  # Zone Alarms and Warnings
  zone-1-warn:
    source: coils
    form:
      type: ParamBool
      address: 5
      idx: zone-1-warn
    triggers: *data_30m
  zone-1-alarm:
    source: coils
    form:
      type: ParamBool
      address: 6
      idx: zone-1-alarm
    triggers: *data_30m
  zone-2-warn:
    source: coils
    form:
      type: ParamBool
      address: 7
      idx: zone-2-warn
    triggers: *data_30m
  zone-2-alarm:
    source: coils
    form:
      type: ParamBool
      address: 8
      idx: zone-2-alarm
    triggers: *data_30m
  zone-3-warn:
    source: coils
    form:
      type: ParamBool
      address: 9
      idx: zone-3-warn
    triggers: *data_30m
  zone-3-alarm:
    source: coils
    form:
      type: ParamBool
      address: 10
      idx: zone-3-alarm
    triggers: *data_30m
  zone-4-warn:
    source: coils
    form:
      type: ParamBool
      address: 11
      idx: zone-4-warn
    triggers: *data_30m
  zone-4-alarm:
    source: coils
    form:
      type: ParamBool
      address: 12
      idx: zone-4-alarm
    triggers: *data_30m
  zone-5-warn:
    source: coils
    form:
      type: ParamBool
      address: 13
      idx: zone-5-warn
    triggers: *data_30m
  zone-5-alarm:
    source: coils
    form:
      type: ParamBool
      address: 14
      idx: zone-5-alarm
    triggers: *data_30m
  zone-6-warn:
    source: coils
    form:
      type: ParamBool
      address: 15
      idx: zone-6-warn
    triggers: *data_30m
  zone-6-alarm:
    source: coils
    form:
      type: ParamBool
      address: 16
      idx: zone-6-alarm
    triggers: *data_30m
  system-reset:
    source: coils
    form:
      type: ParamBool
      address: 21
      idx: system-reset
    triggers:
      process:
        send:
          - [state]
          - [time, 1800]
      write:
        validators:
          - trig_type: writable
    sequences: # Negative pulse trigger (>100ms)
      write:
        - type: write_value
          value: 1
        - type: write_value
          value: 0
        - type: wait
          seconds: 0.2
        - type: write_value
          value: 1
  system-mute:
    source: coils
    form:
      type: ParamBool
      address: 22
      idx: system-mute
    triggers:
      process:
        send:
          - [state]
          - [time, 1800]
      write:
        validators:
          - trig_type: in_list
            lst: [0, 1, false, true]
  save-all-settings:
    source: coils
    form:
      type: ParamBool
      address: 23
      idx: save-all-settings
    triggers:
      process:
        send:
          - [state]
          - [time, 1800]
      write:
        validators:
          - trig_type: writable
    sequences: # Positive pulse trigger (>100ms)
      write:
        - type: write_value
          value: 0
        - type: write_value
          value: 1
        - type: wait
          seconds: 0.2
        - type: write_value
          value: 0
  system-reboot:
    source: coils
    form:
      type: ParamBool
      address: 24
      idx: system-reboot
    triggers:
      process:
        send:
          - [state]
          - [time, 1800]
      write:
        validators:
          - trig_type: writable
    sequences: # Positive pulse trigger (>100ms)
      write:
        - type: write_value
          value: 0
        - type: write_value
          value: 1
        - type: wait
          seconds: 0.2
        - type: write_value
          value: 0
  # Channel Input Values
{% for channel, address in zip(range(1, channels + 1), range(1, 1 + channels * 2, 2)) %}
  ch{{ channel }}-input-value:
    source: holding
    form:
      type: ParamCType
      address: {{ address }}
      idx: ch{{ channel }}-input-value
      data_type: float
    triggers: *data_20s
{% endfor %}
  # Channel Setup Data
{% for channel, address_1, address_2 in zip(range(1, channels + 1), range(101, 101 + channels * 2, 2), range(102, 102 + channels * 2, 2)) %}
  # Channel {{ channel }}
  ch{{ channel }}-setup:
    source: holding
    form:
      type: ParamCType
      address: {{ address_1 }}
      idx: ch{{ channel }}-setup
      data_type: float
    children:
      # MSW
      ch{{ channel }}-input-signal-type:
        form:
          type: ParamMask
          address: {{ address_1 }}
          idx: ch{{ channel }}-input-signal-type
          mask: 0b1110000000000000
          rshift: 13
        triggers:
          process:
            send:
              - [state]
              - [time, 86400]
          write:
            validators:
              - trig_type: range
                min: 0
                max: 5
      ch{{ channel }}-sensor-type:
        form:
          type: ParamMask
          address: {{ address_1 }}
          idx: ch{{ channel }}-sensor-type
          mask: 0b0001111110000000
          rshift: 7
        triggers:
          process:
            send:
              - [state]
              - [time, 86400]
          write:
            validators:
              - trig_type: range
                min: 0
                max: 63
      ch{{ channel }}-sensor-unit:
        form:
          type: ParamMask
          address: {{ address_1 }}
          idx: ch{{ channel }}-sensor-unit
          mask: 0b0000000001111000
          rshift: 3
        triggers:
          process:
            send:
              - [state]
              - [time, 86400]
          write:
            validators:
              - trig_type: range
                min: 0
                max: 15
      ch{{ channel }}-enable:
        form:
          type: ParamMask
          address: {{ address_1 }}
          idx: ch{{ channel }}-enable
          mask: 0b0000000000000100
          rshift: 2
        triggers:
          process:
            send:
              - [state]
              - [time, 1800]
          write:
            validators:
              - trig_type: in_list
                lst: [0, 1, false, true]
      ch{{ channel }}-warn-function:
        form:
          type: ParamMask
          address: {{ address_1 }}
          idx: ch{{ channel }}-warn-function
          mask: 0b0000000000000010
          rshift: 1
        triggers:
          write:
            validators:
              - trig_type: in_list
                lst: [0, 1, false, true]
      ch{{ channel }}-warn-direction:
        form:
          type: ParamMask
          address: {{ address_1 }}
          idx: ch{{ channel }}-warn-direction
          mask: 0b0000000000000001
          rshift: 0
        triggers:
          write:
            validators:
              - trig_type: in_list
                lst: [0, 1, false, true]
      # LSW
      ch{{ channel }}-warn-latch:
        form:
          type: ParamMask
          address: {{ address_2 }}
          idx: ch{{ channel }}-warn-latch
          mask: 0b1000000000000000
          rshift: 15
        triggers:
          process:
            send:
              - [state]
              - [time, 86400]
          write:
            validators:
              - trig_type: in_list
                lst: [0, 1, false, true]
      ch{{ channel }}-warn-relay:
        form:
          type: ParamMask
          address: {{ address_2 }}
          idx: ch{{ channel }}-warn-relay
          mask: 0b0100000000000000
          rshift: 14
        triggers:
          write:
            validators:
              - trig_type: in_list
                lst: [0, 1, false, true]
      ch{{ channel }}-alarm-function:
        form:
          type: ParamMask
          address: {{ address_2 }}
          idx: ch{{ channel }}-alarm-function
          mask: 0b0010000000000000
          rshift: 13
        triggers:
          write:
            validators:
              - trig_type: in_list
                lst: [0, 1, false, true]
      ch{{ channel }}-alarm-direction:
        form:
          type: ParamMask
          address: {{ address_2 }}
          idx: ch{{ channel }}-alarm-direction
          mask: 0b0001000000000000
          rshift: 12
        triggers:
          write:
            validators:
              - trig_type: in_list
                lst: [0, 1, false, true]
      ch{{ channel }}-alarm-latch:
        form:
          type: ParamMask
          address: {{ address_2 }}
          idx: ch{{ channel }}-alarm-latch
          mask: 0b0000100000000000
          rshift: 11
        triggers:
          write:
            validators:
              - trig_type: in_list
                lst: [0, 1, false, true]
      ch{{ channel }}-alarm-relay:
        form:
          type: ParamMask
          address: {{ address_2 }}
          idx: ch{{ channel }}-alarm-relay
          mask: 0b0000010000000000
          rshift: 10
        triggers:
          write:
            validators:
              - trig_type: in_list
                lst: [0, 1, false, true]
      ch{{ channel }}-high-alarm-function:
        form:
          type: ParamMask
          address: {{ address_2 }}
          idx: ch{{ channel }}-high-alarm-function
          mask: 0b0000001000000000
          rshift: 9
        triggers:
          write:
            validators:
              - trig_type: in_list
                lst: [0, 1, false, true]
      ch{{ channel }}-high-alarm-direction:
        form:
          type: ParamMask
          address: {{ address_2 }}
          idx: ch{{ channel }}-high-alarm-direction
          mask: 0b0000000100000000
          rshift: 8
        triggers:
          write:
            validators:
              - trig_type: in_list
                lst: [0, 1, false, true]
      ch{{ channel }}-high-alarm-latch:
        form:
          type: ParamMask
          address: {{ address_2 }}
          idx: ch{{ channel }}-high-alarm-latch
          mask: 0b0000000010000000
          rshift: 7
        triggers:
          write:
            validators:
              - trig_type: in_list
                lst: [0, 1, false, true]
      ch{{ channel }}-high-alarm-relay:
        form:
          type: ParamMask
          address: {{ address_2 }}
          idx: ch{{ channel }}-high-alarm-relay
          mask: 0b0000000001000000
          rshift: 6
        triggers:
          write:
            validators:
              - trig_type: in_list
                lst: [0, 1, false, true]
      ch{{ channel }}-assignment-to-zone-1:
        form:
          type: ParamMask
          address: {{ address_2 }}
          idx: ch{{ channel }}-assignment-to-zone-1
          mask: 0b0000000000100000
          rshift: 5
        triggers:
          process:
            send:
              - [state]
              - [time, 86400]
          write:
            validators:
              - trig_type: in_list
                lst: [0, 1, false, true]
      ch{{ channel }}-assignment-to-zone-2:
        form:
          type: ParamMask
          address: {{ address_2 }}
          idx: ch{{ channel }}-assignment-to-zone-2
          mask: 0b0000000000010000
          rshift: 4
        triggers:
          process:
            send:
              - [state]
              - [time, 86400]
          write:
            validators:
              - trig_type: in_list
                lst: [0, 1, false, true]
      ch{{ channel }}-assignment-to-zone-3:
        form:
          type: ParamMask
          address: {{ address_2 }}
          idx: ch{{ channel }}-assignment-to-zone-3
          mask: 0b0000000000001000
          rshift: 3
        triggers:
          process:
            send:
              - [state]
              - [time, 86400]
          write:
            validators:
              - trig_type: in_list
                lst: [0, 1, false, true]
      ch{{ channel }}-assignment-to-zone-4:
        form:
          type: ParamMask
          address: {{ address_2 }}
          idx: ch{{ channel }}-assignment-to-zone-4
          mask: 0b0000000000000100
          rshift: 2
        triggers:
          process:
            send:
              - [state]
              - [time, 86400]
          write:
            validators:
              - trig_type: in_list
                lst: [0, 1, false, true]
      ch{{ channel }}-assignment-to-zone-5:
        form:
          type: ParamMask
          address: {{ address_2 }}
          idx: ch{{ channel }}-assignment-to-zone-5
          mask: 0b0000000000000010
          rshift: 1
        triggers:
          process:
            send:
              - [state]
              - [time, 86400]
          write:
            validators:
              - trig_type: in_list
                lst: [0, 1, false, true]
      ch{{ channel }}-assignment-to-zone-6:
        form:
          type: ParamMask
          address: {{ address_2 }}
          idx: ch{{ channel }}-assignment-to-zone-6
          mask: 0b0000000000000001
          rshift: 0
        triggers:
          process:
            send:
              - [state]
              - [time, 86400]
          write:
            validators:
              - trig_type: in_list
                lst: [0, 1, false, true]
{% endfor %}
  # Channel High/Low Alarm Set Point
{% for channel, address in zip(range(1, channels + 1), range(401, 401 + channels * 2, 2)) %}
  ch{{ channel }}-high-low-alarm-set-point:
    source: holding
    form:
      type: ParamCType
      address: {{ address }}
      idx: ch{{ channel }}-high-low-alarm-set-point
      data_type: float
    triggers:
      process:
        send:
          - [state]
          - [time, 86400]
      write:
        validators:
          - trig_type: writable
{% endfor %}
  # Channel High/Low Alarm Set Point
{% for channel, address in zip(range(1, channels + 1), range(501, 501 + channels * 2, 2)) %}
  ch{{ channel }}-low-warn-set-point:
    source: holding
    form:
      type: ParamCType
      address: {{ address }}
      idx: ch{{ channel }}-low-warn-set-point
      data_type: float
    triggers:
      process:
        send:
          - [state]
          - [time, 86400]
      write:
        validators:
          - trig_type: writable
{% endfor %}
  # Channel High/Low Alarm Set Point
{% for channel, address in zip(range(1, channels + 1), range(601, 601 + channels * 2, 2)) %}
  ch{{ channel }}-warn-set-point:
    source: holding
    form:
      type: ParamCType
      address: {{ address }}
      idx: ch{{ channel }}-warn-set-point
      data_type: float
    triggers:
      process:
        send:
          - [state]
          - [time, 86400]
      write:
        validators:
          - trig_type: writable
{% endfor %}
  # Channel High/Low Alarm Set Point
{% for channel, address in zip(range(1, channels + 1), range(701, 701 + channels * 2, 2)) %}
  ch{{ channel }}-alarm-set-point:
    source: holding
    form:
      type: ParamCType
      address: {{ address }}
      idx: ch{{ channel }}-alarm-set-point
      data_type: float
    triggers:
      process:
        send:
          - [state]
          - [time, 86400]
      write:
        validators:
          - trig_type: writable
{% endfor %}
  # Channel Calibration Due Dates
{% for channel, address in zip(range(1, channels + 1), range(801, 801 + channels)) %}
  ch{{ channel }}-calibration-due-date:
    source: holding
    form:
      type: Param
      address: {{ address }}
      idx: ch{{ channel }}-calibration-due-date
    children:
      ch{{ channel }}-calibration-due-year:
        form:
          type: ParamMask
          address: {{ address }}
          idx: ch{{ channel }}-calibration-due-year
          mask: 0b1111111000000000
          rshift: 9
        triggers: *data_24h
      ch{{ channel }}-calibration-due-month:
        form:
          type: ParamMask
          address: {{ address }}
          idx: ch{{ channel }}-calibration-due-month
          mask: 0b0000000111100000
          rshift: 5
        triggers: *data_24h
      ch{{ channel }}-calibration-due-day:
        form:
          type: ParamMask
          address: {{ address }}
          idx: ch{{ channel }}-calibration-due-day
          mask: 0b0000000000011111
          rshift: 0
        triggers: *data_24h
    triggers: *data_24h
{% endfor %}
  # Channel Status Flags
{% for channel, address in zip(range(1, channels + 1), range(901, 901 + channels, 1)) %}
  ch{{ channel }}-status-flag:
    source: holding
    form:
      type: Param
      address: {{ address }}
      idx: ch{{ channel }}-status-flag
    triggers: *data_30m
{% endfor %}
  # Channel IDs
{% for channel, address in zip(range(1, channels + 1), range(1001, 1001 + channels * 6, 6)) %}
  ch{{ channel }}-id:
    source: holding
    form:
      type: ParamText
      address: {{ address }}
      idx: ch{{ channel }}-id
      length: 6
      swap_bytes: True
    triggers: *data_24h
{% endfor %}
